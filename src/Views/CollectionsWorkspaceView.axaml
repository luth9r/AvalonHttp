<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:AvalonHttp.ViewModels"
             xmlns:lucide="clr-namespace:LucideAvalonia;assembly=LucideAvalonia"
             xmlns:controls="clr-namespace:AvalonHttp.Controls"
             xmlns:behaviors="clr-namespace:AvalonHttp.Behaviors"
             x:Class="AvalonHttp.Views.CollectionsWorkspaceView"
             x:DataType="vm:CollectionWorkspaceViewModel">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280" MinWidth="200" MaxWidth="400" /> <ColumnDefinition Width="5" />
            <ColumnDefinition Width="*" MinWidth="400" />
        </Grid.ColumnDefinitions>

        <!-- ============================= -->
        <!-- COLLECTIONS SIDEBAR           -->
        <!-- ============================= -->
        <Border Grid.Column="0"
                Background="{DynamicResource BgSidebarBrush}"
                BorderBrush="{DynamicResource BorderColor}"
                BorderThickness="0,0,1,0"
                PointerPressed="OnSidebarClicked">

            <DockPanel>
                <!-- Collections Header -->
                <StackPanel DockPanel.Dock="Top" Margin="20,20,20,16" Spacing="12">
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="COLLECTIONS"
                                   Grid.Column="0"
                                   Foreground="{DynamicResource TextSecondary}"
                                   FontSize="11"
                                   FontWeight="SemiBold"
                                   LetterSpacing="1" />

                        <Button Grid.Column="1"
                                Classes="IconButton"
                                Command="{Binding CollectionsViewModel.CreateCollectionCommand}"
                                ToolTip.Tip="New Collection">
                            <lucide:Lucide Icon="Plus"
                                           StrokeBrush="{DynamicResource TextSecondary}"
                                           Width="16" Height="16" />
                        </Button>
                    </Grid>

                    <TextBox Watermark="Search collections and requests..."
                             Text="{Binding CollectionsViewModel.SearchText, Mode=TwoWay}" />
                </StackPanel>

                <!-- Bottom Add Collection Button -->
                <Border DockPanel.Dock="Bottom"
                        Background="{DynamicResource BgElevated}"
                        BorderBrush="{DynamicResource BorderColor}"
                        BorderThickness="0,1,0,0"
                        Padding="16,12,16,24">

                    <Button Command="{Binding CollectionsViewModel.CreateCollectionCommand}"
                            Background="Transparent"
                            BorderBrush="{DynamicResource BorderColor}"
                            BorderThickness="1"
                            CornerRadius="6"
                            Padding="12,8"
                            HorizontalAlignment="Stretch"
                            Cursor="Hand">
                        <Grid ColumnDefinitions="Auto,*,Auto">
                            <TextBlock Grid.Column="0"
                                       Text="Add Collection"
                                       Foreground="{DynamicResource TextPrimary}"
                                       VerticalAlignment="Center"
                                       Margin="0,0,8,0" />
                        </Grid>
                    </Button>
                </Border>


                <!-- Collections Tree -->
                <ScrollViewer>
                    <ItemsControl ItemsSource="{Binding CollectionsViewModel.Collections}"
                                  Margin="12,0,12,12">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Margin="0,0,0,8" IsVisible="{Binding IsVisible}">
                                    <!-- Collection Item Card -->
                                    <Border CornerRadius="6"
                                            Padding="12,10"
                                            Cursor="Hand"
                                            Background="{DynamicResource BgMain}"
                                            BorderBrush="{DynamicResource BorderColor}"
                                            BorderThickness="1">
                                        <Interaction.Behaviors>
                                            <behaviors:DragDropBehavior />
                                        </Interaction.Behaviors>

                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                            <Button Grid.Column="0"
                                                    Classes="IconButton"
                                                    Command="{Binding ToggleExpandCommand}"
                                                    Padding="4">
                                                <lucide:Lucide Icon="ChevronDown"
                                                               Width="14" Height="14"
                                                               StrokeBrush="{DynamicResource TextSecondary}">
                                                    <lucide:Lucide.RenderTransform>
                                                        <RotateTransform
                                                            Angle="{Binding IsExpanded, Converter={StaticResource BoolToAngleConverter}}" />
                                                    </lucide:Lucide.RenderTransform>
                                                </lucide:Lucide>
                                            </Button>

                                            <Grid Grid.Column="1"
                                                  ColumnDefinitions="Auto,*"
                                                  Margin="4,0"
                                                  VerticalAlignment="Center"
                                                  Background="Transparent">

                                                <Grid.Styles>
                                                    <Style Selector="Grid">
                                                        <Setter Property="Cursor" Value="Hand" />
                                                    </Style>
                                                </Grid.Styles>

                                                <Interaction.Behaviors>
                                                    <EventTriggerBehavior EventName="DoubleTapped">
                                                        <InvokeCommandAction Command="{Binding StartRenameCommand}" />
                                                    </EventTriggerBehavior>
                                                </Interaction.Behaviors>

                                                <lucide:Lucide Grid.Column="0"
                                                               Icon="Folder"
                                                               StrokeBrush="#F59E0B"
                                                               Width="16" Height="16"
                                                               Margin="0,0,8,0" />


                                                <TextBox Grid.Column="1"
                                                         Text="{Binding Name}"
                                                         IsVisible="{Binding IsEditing}"
                                                         BorderBrush="{DynamicResource AccentBrush}"
                                                         BorderThickness="1"
                                                         Background="{DynamicResource BgElevated}"
                                                         Foreground="{DynamicResource TextPrimary}"
                                                         FontWeight="Medium"
                                                         FontSize="13"
                                                         CornerRadius="4"
                                                         Padding="6,4">
                                                    <TextBox.KeyBindings>
                                                        <KeyBinding Gesture="Enter"
                                                                    Command="{Binding FinishRenameCommand}" />
                                                        <KeyBinding Gesture="Escape"
                                                                    Command="{Binding FinishRenameCommand}" />
                                                    </TextBox.KeyBindings>
                                                    <Interaction.Behaviors>
                                                        <EventTriggerBehavior EventName="LostFocus">
                                                            <InvokeCommandAction
                                                                Command="{Binding FinishRenameCommand}" />
                                                        </EventTriggerBehavior>
                                                    </Interaction.Behaviors>
                                                </TextBox>

                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding Name}"
                                                           IsVisible="{Binding !IsEditing}"
                                                           VerticalAlignment="Center"
                                                           Foreground="{DynamicResource TextPrimary}"
                                                           FontWeight="Medium"
                                                           FontSize="13"
                                                           TextTrimming="CharacterEllipsis" />
                                            </Grid>

                                            <Button Grid.Column="2"
                                                    Classes="IconButton"
                                                    Padding="4">
                                                <lucide:Lucide Icon="Menu"
                                                               Width="14" Height="14"
                                                               StrokeBrush="{DynamicResource TextSecondary}" />
                                                <Button.Flyout>
                                                    <MenuFlyout>
                                                        <MenuItem Header="Rename"
                                                                  Command="{Binding StartRenameCommand}">
                                                            <MenuItem.Icon>
                                                                <lucide:Lucide Icon="Pencil" Width="14" />
                                                            </MenuItem.Icon>
                                                        </MenuItem>
                                                        <MenuItem Header="Add Request"
                                                                  Command="{Binding AddRequestCommand}">
                                                            <MenuItem.Icon>
                                                                <lucide:Lucide Icon="Plus" Width="14" />
                                                            </MenuItem.Icon>
                                                        </MenuItem>
                                                        <MenuItem Header="Duplicate"
                                                                  Command="{Binding $parent[UserControl].((vm:CollectionWorkspaceViewModel)DataContext).CollectionsViewModel.DuplicateCollectionCommand}"
                                                                  CommandParameter="{Binding}">
                                                            <MenuItem.Icon>
                                                                <lucide:Lucide Icon="Copy" Width="14" />
                                                            </MenuItem.Icon>
                                                        </MenuItem>
                                                        <Separator />
                                                        <MenuItem Header="Delete"
                                                                  Command="{Binding $parent[UserControl].((vm:CollectionWorkspaceViewModel)DataContext).CollectionsViewModel.DeleteCollectionCommand}"
                                                                  CommandParameter="{Binding}">
                                                            <MenuItem.Icon>
                                                                <lucide:Lucide Icon="Trash2" Width="14" />
                                                            </MenuItem.Icon>
                                                        </MenuItem>
                                                    </MenuFlyout>
                                                </Button.Flyout>
                                            </Button>
                                        </Grid>
                                    </Border>


                                    <!-- Requests List -->
                                    <ItemsControl ItemsSource="{Binding FilteredRequests}"
                                                  IsVisible="{Binding IsExpanded}"
                                                  Margin="0,4,0,0">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border CornerRadius="6"
                                                        Padding="10,8"
                                                        Margin="0,0,0,4"
                                                        Cursor="Hand"
                                                        Background="{DynamicResource BgMain}"
                                                        BorderBrush="{DynamicResource BorderColor}"
                                                        BorderThickness="1"
                                                        Classes.selected="{Binding IsSelected}">

                                                    <Border.Styles>
                                                        <!-- Selected Style -->
                                                        <Style Selector="Border.selected">
                                                            <Setter Property="Background" Value="#1A1F2E" />
                                                            <Setter Property="BorderBrush"
                                                                    Value="{DynamicResource AccentBrush}" />
                                                            <Setter Property="BorderThickness" Value="1" />
                                                        </Style>
                                                    </Border.Styles>

                                                    <Interaction.Behaviors>
                                                        <behaviors:DragDropBehavior />
                                                    </Interaction.Behaviors>

                                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                                        <Border Grid.Column="0"
                                                                Classes="MethodBadge"
                                                                Margin="0,0,8,0"
                                                                Background="{Binding Method, Converter={StaticResource MethodToBrushConverter}, ConverterParameter=Bg}">
                                                            <TextBlock Text="{Binding Method}"
                                                                       Foreground="{Binding Method, Converter={StaticResource MethodToBrushConverter}, ConverterParameter=Fg}" />
                                                        </Border>


                                                        <TextBox Grid.Column="1"
                                                                 Text="{Binding Name}"
                                                                 IsVisible="{Binding IsEditing}"
                                                                 BorderBrush="{DynamicResource AccentBrush}"
                                                                 BorderThickness="1"
                                                                 Background="{DynamicResource BgElevated}"
                                                                 Foreground="{DynamicResource TextPrimary}"
                                                                 FontSize="13"
                                                                 CornerRadius="4"
                                                                 Padding="6,4">
                                                            <TextBox.KeyBindings>
                                                                <KeyBinding Gesture="Enter"
                                                                            Command="{Binding FinishRenameCommand}" />
                                                                <KeyBinding Gesture="Escape"
                                                                            Command="{Binding CancelRenameCommand}" />
                                                            </TextBox.KeyBindings>
                                                            <Interaction.Behaviors>
                                                                <EventTriggerBehavior EventName="LostFocus">
                                                                    <InvokeCommandAction
                                                                        Command="{Binding FinishRenameCommand}" />
                                                                </EventTriggerBehavior>
                                                            </Interaction.Behaviors>
                                                        </TextBox>

                                                        <Grid Grid.Column="1"
                                                              ColumnDefinitions="*,Auto"
                                                              IsVisible="{Binding !IsEditing}"
                                                              ColumnSpacing="6">
                                                            <Border Grid.Column="0" Background="Transparent"
                                                                    Cursor="Hand">
                                                                <Interaction.Behaviors>
                                                                    <EventTriggerBehavior EventName="DoubleTapped">
                                                                        <InvokeCommandAction
                                                                            Command="{Binding StartRenameCommand}" />
                                                                    </EventTriggerBehavior>
                                                                    <EventTriggerBehavior EventName="Tapped">
                                                                        <InvokeCommandAction
                                                                            Command="{Binding SelectCommand}" />
                                                                    </EventTriggerBehavior>
                                                                </Interaction.Behaviors>
                                                                <TextBlock Text="{Binding Name}"
                                                                           VerticalAlignment="Center"
                                                                           Foreground="{DynamicResource TextPrimary}"
                                                                           FontSize="13"
                                                                           TextTrimming="CharacterEllipsis" />
                                                            </Border>
                                                            <Border Grid.Column="1"
                                                                    Width="6" Height="6"
                                                                    CornerRadius="3"
                                                                    Background="{DynamicResource AccentBrush}"
                                                                    VerticalAlignment="Center"
                                                                    IsVisible="{Binding IsDirty}"
                                                                    ToolTip.Tip="Unsaved changes" />
                                                        </Grid>

                                                        <Button Grid.Column="2" Classes="IconButton" Padding="4">
                                                            <lucide:Lucide Icon="Menu" Width="12" Height="12"
                                                                           StrokeBrush="{DynamicResource TextSecondary}" />
                                                            <Button.Flyout>
                                                                <MenuFlyout>
                                                                    <MenuItem Header="Rename"
                                                                              Command="{Binding StartRenameCommand}">
                                                                        <MenuItem.Icon>
                                                                            <lucide:Lucide Icon="Pencil" Width="14" />
                                                                        </MenuItem.Icon>
                                                                    </MenuItem>
                                                                    <MenuItem Header="Duplicate"
                                                                              Command="{Binding DuplicateCommand}">
                                                                        <MenuItem.Icon>
                                                                            <lucide:Lucide Icon="Copy" Width="14" />
                                                                        </MenuItem.Icon>
                                                                    </MenuItem>
                                                                    <Separator />
                                                                    <MenuItem Header="Delete"
                                                                              Command="{Binding DeleteCommand}">
                                                                        <MenuItem.Icon>
                                                                            <lucide:Lucide Icon="Trash2" Width="14" />
                                                                        </MenuItem.Icon>
                                                                    </MenuItem>
                                                                </MenuFlyout>
                                                            </Button.Flyout>
                                                        </Button>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </DockPanel>
        </Border>

        <!-- ============================= -->
        <!-- SPLITTER                      -->
        <!-- ============================= -->
        <GridSplitter Grid.Column="1"
                      Width="5"
                      Background="{DynamicResource BorderColor}"
                      ResizeDirection="Columns"
                      ResizeBehavior="PreviousAndNext" />

        <!-- ============================= -->
        <!-- MAIN CONTENT AREA             -->
        <!-- ============================= -->
        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" MinHeight="200" />
            </Grid.RowDefinitions>

            <!-- ============================= -->
            <!-- REQUEST HEADER                -->
            <!-- ============================= -->
            <Border Grid.Row="0"
                    Background="{DynamicResource BgElevated}"
                    BorderBrush="{DynamicResource BorderColor}"
                    BorderThickness="0,0,0,1"
                    Padding="20,16">
                <Grid RowDefinitions="Auto, Auto" RowSpacing="12">
                    <!-- Request Name -->
                    <Grid Grid.Row="0" ColumnDefinitions="Auto, *, Auto, Auto" ColumnSpacing="8">
                        <lucide:Lucide Grid.Column="0" Icon="File" StrokeBrush="{DynamicResource TextSecondary}"
                                       Width="14" Height="14" VerticalAlignment="Center" />
                        <TextBox Grid.Column="1" Text="{Binding RequestViewModel.Name, Mode=TwoWay}"
                                 BorderThickness="0" Background="Transparent"
                                 Foreground="{DynamicResource TextPrimary}" FontWeight="Medium" FontSize="13"
                                 VerticalAlignment="Center" />

                        <!-- Save Button -->
                        <Button Grid.Column="3"
                                Classes="SaveButton"
                                Command="{Binding RequestViewModel.SaveCurrentRequestCommand}"
                                ToolTip.Tip="Save changes (Ctrl+S)">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <lucide:Lucide Icon="Save"
                                               StrokeBrush="White"
                                               Width="14" Height="14"
                                               VerticalAlignment="Center" />
                                <TextBlock Text="Save"
                                           FontWeight="SemiBold"
                                           FontSize="12"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>
                    </Grid>
                    <!-- Request URL Bar -->
                    <Grid Grid.Row="1" ColumnDefinitions="Auto, *, Auto" ColumnSpacing="12">
                        <ComboBox Grid.Column="0" SelectedItem="{Binding RequestViewModel.SelectedMethod}"
                                  ItemsSource="{Binding RequestViewModel.HttpMethods}" Classes="MethodDropdown"
                                  MinWidth="90" />
                        <controls:VariableTextBox Grid.Column="1"
                                                  Text="{Binding RequestViewModel.RequestUrl}"
                                                  Watermark="Enter request URL..."
                                                  EnvironmentsViewModel="{Binding EnvironmentsViewModel}"
                                                  Classes="UrlInput" />
                        <Button Grid.Column="2" Classes="SendButton"
                                Command="{Binding RequestViewModel.SendRequestCommand}">
                            <Grid ColumnDefinitions="Auto, Auto" ColumnSpacing="8">
                                <lucide:Lucide Grid.Column="0" Icon="Send" StrokeBrush="White" Width="16" Height="16" />
                                <TextBlock Grid.Column="1" Text="Send" />
                            </Grid>
                        </Button>
                    </Grid>
                </Grid>
            </Border>

            <!-- ============================= -->
            <!-- REQUEST TABS                  -->
            <!-- ============================= -->
            <Border Grid.Row="1" Background="{DynamicResource BgElevated}" BorderBrush="{DynamicResource BorderColor}"
                    BorderThickness="0,0,0,1">
                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                    <StackPanel Orientation="Horizontal" Margin="20,0" Spacing="4">
                        <Border Classes="Tab"
                                Classes.Active="{Binding RequestViewModel.SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Params}"
                                PointerPressed="SelectRequestTab" Tag="Params">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="Params" />
                                <Border Classes="Badge"
                                        IsVisible="{Binding RequestViewModel.QueryParamsViewModel.EnabledParametersCount, Converter={x:Static ObjectConverters.NotEqual}, ConverterParameter=0}">
                                    <TextBlock
                                        Text="{Binding RequestViewModel.QueryParamsViewModel.EnabledParametersCount}" />
                                </Border>
                            </StackPanel>
                        </Border>
                        <Border Classes="Tab"
                                Classes.Active="{Binding RequestViewModel.SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Auth}"
                                PointerPressed="SelectRequestTab" Tag="Auth">
                            <TextBlock Text="Auth" />
                        </Border>
                        <Border Classes="Tab"
                                Classes.Active="{Binding RequestViewModel.SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Headers}"
                                PointerPressed="SelectRequestTab" Tag="Headers">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="Headers" />
                                <Border Classes="Badge"
                                        IsVisible="{Binding RequestViewModel.HeadersViewModel.EnabledHeadersCount, Converter={x:Static ObjectConverters.NotEqual}, ConverterParameter=0}">
                                    <TextBlock Text="{Binding RequestViewModel.HeadersViewModel.EnabledHeadersCount}" />
                                </Border>
                            </StackPanel>
                        </Border>
                        <Border Classes="Tab"
                                Classes.Active="{Binding RequestViewModel.SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Body}"
                                PointerPressed="SelectRequestTab" Tag="Body">
                            <TextBlock Text="Body" />
                        </Border>
                        <Border Classes="Tab"
                                Classes.Active="{Binding RequestViewModel.SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Cookies}"
                                PointerPressed="SelectRequestTab" Tag="Cookies">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="Cookies" />
                                <Border Classes="Badge"
                                        IsVisible="{Binding RequestViewModel.CookiesViewModel.EnabledCookiesCount, Converter={x:Static ObjectConverters.NotEqual}, ConverterParameter=0}">
                                    <TextBlock Text="{Binding RequestViewModel.CookiesViewModel.EnabledCookiesCount}" />
                                </Border>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- ============================= -->
            <!-- REQUEST/RESPONSE CONTENT      -->
            <!-- ============================= -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" MinWidth="300" MaxWidth="600" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" MinWidth="350" />
                </Grid.ColumnDefinitions>

                <!-- ============================= -->
                <!-- REQUEST PANEL                 -->
                <!-- ============================= -->
                <ScrollViewer Grid.Column="0" Background="{DynamicResource BgMain}">
                    <StackPanel Margin="20" Spacing="24">
                        <!-- PARAMS TAB -->
                        <StackPanel
                            IsVisible="{Binding RequestViewModel.SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Params}">
                            <TextBlock Text="QUERY PARAMETERS" Classes="SectionTitle" />
                            <ItemsControl ItemsSource="{Binding RequestViewModel.QueryParamsViewModel.Parameters}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnSpacing="12" Margin="0,6">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="40" />
                                                <ColumnDefinition Width="*" MinWidth="60" />
                                                <ColumnDefinition Width="*" MinWidth="60" />
                                                <ColumnDefinition Width="40" />
                                            </Grid.ColumnDefinitions>
                                            <CheckBox Grid.Column="0" IsChecked="{Binding IsEnabled}" />
                                            <controls:VariableTextBox Grid.Column="1"
                                                                      Text="{Binding Key}"
                                                                      Watermark="Param name"
                                                                      Classes="KvInput"
                                                                      EnvironmentsViewModel="{Binding $parent[UserControl].((vm:CollectionWorkspaceViewModel)DataContext).EnvironmentsViewModel}" />
                                            <controls:VariableTextBox Grid.Column="2"
                                                                      Text="{Binding Value}"
                                                                      Classes="KvInput"
                                                                      Watermark="Value"
                                                                      EnvironmentsViewModel="{Binding $parent[UserControl].((vm:CollectionWorkspaceViewModel)DataContext).EnvironmentsViewModel}" />
                                            <Button Grid.Column="3" Classes="IconButton"
                                                    Command="{Binding ((vm:CollectionWorkspaceViewModel)DataContext).RequestViewModel.QueryParamsViewModel.RemoveParameterCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}">
                                                <lucide:Lucide Icon="Trash2" StrokeBrush="{DynamicResource TextMuted}"
                                                               Width="16" Height="16" />
                                            </Button>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <Button Classes="AddRowButton" Margin="0,12,0,0"
                                    Command="{Binding RequestViewModel.QueryParamsViewModel.AddParameterCommand}">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <lucide:Lucide Icon="Plus" StrokeBrush="{DynamicResource TextSecondary}" Width="14"
                                                   Height="14" />
                                    <TextBlock Text="Add Parameter" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <!-- AUTH TAB -->
                        <StackPanel
                            IsVisible="{Binding RequestViewModel.SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Auth}">
                            <TextBlock Text="AUTHORIZATION" Classes="SectionTitle" Margin="0,0,0,12" />

                            <!-- Auth Type Selector -->
                            <TextBlock Text="Auth Type"
                                       Foreground="{DynamicResource TextSecondary}"
                                       FontSize="12"
                                       Margin="0,0,0,6" />
                            <ComboBox
                                SelectedItem="{Binding RequestViewModel.AuthViewModel.SelectedAuthType}"
                                ItemsSource="{Binding RequestViewModel.AuthViewModel.AuthTypes}"
                                MinWidth="200"
                                Margin="0,0,0,20" />

                            <!-- Basic Auth -->
                            <StackPanel
                                IsVisible="{Binding RequestViewModel.AuthViewModel.SelectedAuthType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Basic Auth'}"
                                Spacing="12">
                                <TextBlock Text="Username"
                                           Foreground="{DynamicResource TextSecondary}"
                                           FontSize="12" />
                                <controls:VariableTextBox Grid.Column="2"
                                                          Text="{Binding RequestViewModel.AuthViewModel.BasicUsername}"
                                                          Watermark="Value"
                                                          Classes="KvInput"
                                                          EnvironmentsViewModel="{Binding $parent[UserControl].((vm:CollectionWorkspaceViewModel)DataContext).EnvironmentsViewModel}" />

                                <TextBlock Text="Password"
                                           Foreground="{DynamicResource TextSecondary}"
                                           FontSize="12" />
                                <TextBox Text="{Binding RequestViewModel.AuthViewModel.BasicPassword}"
                                         Watermark="Enter password"
                                         PasswordChar="•"
                                         Classes="KvInput" />
                            </StackPanel>

                            <!-- Bearer Token -->
                            <StackPanel
                                IsVisible="{Binding RequestViewModel.AuthViewModel.SelectedAuthType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Bearer Token'}"
                                Spacing="12">
                                <TextBlock Text="Token"
                                           Foreground="{DynamicResource TextSecondary}"
                                           FontSize="12" />
                                <controls:VariableTextBox Text="{Binding RequestViewModel.AuthViewModel.BearerToken}"
                                                          Watermark="Enter bearer token"
                                                          Classes="KvInput"
                                                          EnvironmentsViewModel="{Binding EnvironmentsViewModel}" />
                            </StackPanel>

                            <!-- API Key -->
                            <StackPanel
                                IsVisible="{Binding RequestViewModel.AuthViewModel.SelectedAuthType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='API Key'}"
                                Spacing="12">
                                <TextBlock Text="Key Name"
                                           Foreground="{DynamicResource TextSecondary}"
                                           FontSize="12" />
                                <controls:VariableTextBox Text="{Binding RequestViewModel.AuthViewModel.ApiKeyValue}"
                                                          Watermark="Enter API key"
                                                          Classes="KvInput"
                                                          EnvironmentsViewModel="{Binding EnvironmentsViewModel}" />

                                <TextBlock Text="Key Value"
                                           Foreground="{DynamicResource TextSecondary}"
                                           FontSize="12" />
                                <TextBox Text="{Binding RequestViewModel.AuthViewModel.ApiKeyValue}"
                                         Watermark="Enter API key"
                                         Classes="KvInput" />

                                <TextBlock Text="Add To"
                                           Foreground="{DynamicResource TextSecondary}"
                                           FontSize="12" />
                                <ComboBox
                                    SelectedItem="{Binding RequestViewModel.AuthViewModel.ApiKeyLocation}"
                                    ItemsSource="{Binding RequestViewModel.AuthViewModel.ApiKeyLocations}"
                                    MinWidth="200" />
                            </StackPanel>

                            <!-- None Message -->
                            <StackPanel
                                IsVisible="{Binding RequestViewModel.AuthViewModel.SelectedAuthType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=None}"
                                Spacing="8">
                                <Border Background="{DynamicResource BgElevated}"
                                        BorderBrush="{DynamicResource BorderColor}"
                                        BorderThickness="1"
                                        CornerRadius="6"
                                        Padding="16">
                                    <StackPanel Spacing="8">
                                        <lucide:Lucide Icon="ShieldOff"
                                                       StrokeBrush="{DynamicResource TextMuted}"
                                                       Width="32"
                                                       Height="32"
                                                       HorizontalAlignment="Center" />
                                        <TextBlock Text="No authentication"
                                                   Foreground="{DynamicResource TextPrimary}"
                                                   FontSize="14"
                                                   FontWeight="Medium"
                                                   HorizontalAlignment="Center" />
                                        <TextBlock
                                            Text="This request will be sent without authentication"
                                            Foreground="{DynamicResource TextMuted}"
                                            FontSize="12"
                                            TextWrapping="Wrap"
                                            HorizontalAlignment="Center" />
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </StackPanel>

                        <!-- HEADERS TAB -->
                        <StackPanel
                            IsVisible="{Binding RequestViewModel.SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Headers}">
                            <TextBlock Text="REQUEST HEADERS" Classes="SectionTitle" />
                            <ItemsControl ItemsSource="{Binding RequestViewModel.HeadersViewModel.Headers}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnSpacing="12" Margin="0,6">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="40" />
                                                <ColumnDefinition Width="*" MinWidth="80" />
                                                <ColumnDefinition Width="*" MinWidth="80" />
                                                <ColumnDefinition Width="40" />
                                            </Grid.ColumnDefinitions>
                                            <CheckBox Grid.Column="0" IsChecked="{Binding IsEnabled}" />
                                            <controls:VariableTextBox Grid.Column="1"
                                                                      Text="{Binding Key}"
                                                                      Watermark="Header name"
                                                                      Classes="KvInput"
                                                                      EnvironmentsViewModel="{Binding $parent[UserControl].((vm:CollectionWorkspaceViewModel)DataContext).EnvironmentsViewModel}" />
                                            <controls:VariableTextBox Grid.Column="2"
                                                                      Text="{Binding Value}"
                                                                      Watermark="Value"
                                                                      Classes="KvInput"
                                                                      EnvironmentsViewModel="{Binding $parent[UserControl].((vm:CollectionWorkspaceViewModel)DataContext).EnvironmentsViewModel}" />
                                            <Button Grid.Column="3" Classes="IconButton"
                                                    Command="{Binding ((vm:CollectionWorkspaceViewModel)DataContext).RequestViewModel.HeadersViewModel.RemoveHeaderCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}">
                                                <lucide:Lucide Icon="Trash2" StrokeBrush="{DynamicResource TextMuted}"
                                                               Width="16" Height="16" />
                                            </Button>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <Button Classes="AddRowButton" Margin="0,12,0,0"
                                    Command="{Binding RequestViewModel.HeadersViewModel.AddHeaderCommand}">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <lucide:Lucide Icon="Plus" StrokeBrush="{DynamicResource TextSecondary}" Width="14"
                                                   Height="14" />
                                    <TextBlock Text="Add Header" />
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <!-- BODY TAB -->
                        <StackPanel
                            IsVisible="{Binding RequestViewModel.SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Body}">
                            <TextBlock Text="REQUEST BODY" Classes="SectionTitle" />
                            <controls:JsonBodyEditor Text="{Binding RequestViewModel.RequestBody}" 
                                                     ContentType="{Binding RequestViewModel.ResponseContentType}"
                                                     MinHeight="300"
                                                     Margin="0,12,0,0" />
                        </StackPanel>

                        <!-- COOKIES TAB -->
                        <StackPanel
                            IsVisible="{Binding RequestViewModel.SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Cookies}">
                            <TextBlock Text="REQUEST COOKIES" Classes="SectionTitle" />
                            <ItemsControl ItemsSource="{Binding RequestViewModel.CookiesViewModel.Cookies}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnSpacing="12" Margin="0,6">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="40" />
                                                <ColumnDefinition Width="*" MinWidth="80" />
                                                <ColumnDefinition Width="*" MinWidth="80" />
                                                <ColumnDefinition Width="40" />
                                            </Grid.ColumnDefinitions>
                                            <CheckBox Grid.Column="0" IsChecked="{Binding IsEnabled}"
                                                      VerticalAlignment="Center" />
                                            <controls:VariableTextBox Grid.Column="1"
                                                                      Text="{Binding Key}"
                                                                      Watermark="Cookie name"
                                                                      Classes="KvInput"
                                                                      EnvironmentsViewModel="{Binding $parent[UserControl].((vm:CollectionWorkspaceViewModel)DataContext).EnvironmentsViewModel}" />
                                            <controls:VariableTextBox Grid.Column="2"
                                                                      Text="{Binding Value}"
                                                                      Watermark="Cookie value"
                                                                      Classes="KvInput"
                                                                      EnvironmentsViewModel="{Binding $parent[UserControl].((vm:CollectionWorkspaceViewModel)DataContext).EnvironmentsViewModel}" />
                                            <Button Grid.Column="3" Classes="IconButton"
                                                    Command="{Binding ((vm:CollectionWorkspaceViewModel)DataContext).RequestViewModel.CookiesViewModel.RemoveCookieCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}">
                                                <lucide:Lucide Icon="Trash2" StrokeBrush="{DynamicResource TextMuted}"
                                                               Width="16" Height="16" />
                                            </Button>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <Button Classes="AddRowButton" Margin="0,12,0,0"
                                    Command="{Binding RequestViewModel.CookiesViewModel.AddCookieCommand}">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <lucide:Lucide Icon="Plus" StrokeBrush="{DynamicResource TextSecondary}" Width="14"
                                                   Height="14" />
                                    <TextBlock Text="Add Cookie" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>

                <!-- ============================= -->
                <!-- SPLITTER                      -->
                <!-- ============================= -->
                <GridSplitter Grid.Column="1" Width="5" Background="{DynamicResource BorderColor}"
                              ResizeDirection="Columns" ResizeBehavior="PreviousAndNext" />

                <!-- ============================= -->
                <!-- RESPONSE PANEL                -->
                <!-- ============================= -->
                <Grid Grid.Column="2">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" MinHeight="150" />
                    </Grid.RowDefinitions>

                    <!-- Response Status Bar -->
                    <Border Grid.Row="0" Background="{DynamicResource BgElevated}"
                            BorderBrush="{DynamicResource BorderColor}" BorderThickness="0,0,0,1" Padding="16,12">
                        <Grid ColumnDefinitions="Auto, *, Auto" ColumnSpacing="12">
                            <Grid Grid.Column="0" ColumnDefinitions="Auto, Auto, Auto" ColumnSpacing="12">
                                <Border Grid.Column="0" Background="{Binding RequestViewModel.StatusBrush}" Padding="8"
                                        CornerRadius="6">
                                    <TextBlock Text="{Binding RequestViewModel.StatusCode}" Foreground="White"
                                               FontSize="11" FontWeight="SemiBold" />
                                </Border>
                                <Grid Grid.Column="1" ColumnDefinitions="Auto, Auto" ColumnSpacing="6">
                                    <lucide:Lucide Grid.Column="0" Icon="Clock"
                                                   StrokeBrush="{DynamicResource AccentTeal}" Width="14" Height="14"
                                                   VerticalAlignment="Center" />
                                    <TextBlock Grid.Column="1" Text="{Binding RequestViewModel.ResponseTime}"
                                               Foreground="{DynamicResource TextSecondary}" FontSize="12"
                                               VerticalAlignment="Center" />
                                </Grid>
                                <Grid Grid.Column="2" ColumnDefinitions="Auto, Auto" ColumnSpacing="6">
                                    <lucide:Lucide Grid.Column="0" Icon="Package"
                                                   StrokeBrush="{DynamicResource AccentTeal}" Width="14" Height="14"
                                                   VerticalAlignment="Center" />
                                    <TextBlock Grid.Column="1" Text="{Binding RequestViewModel.ResponseSize}"
                                               Foreground="{DynamicResource TextSecondary}" FontSize="12"
                                               VerticalAlignment="Center" />
                                </Grid>
                            </Grid>
                            <Button Grid.Column="2" IsEnabled="{Binding RequestViewModel.HasResponseData}" Classes="ActionButton" ToolTip.Tip="Save Response to File" MinWidth="0"
                                    Padding="8" Command="{Binding RequestViewModel.SaveResponseCommand}">
                                <lucide:Lucide Icon="Save" StrokeBrush="White" Width="14"
                                               Height="14" />
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Response Tabs -->
                    <Border Grid.Row="1" Background="{DynamicResource BgElevated}"
                            BorderBrush="{DynamicResource BorderColor}" BorderThickness="0,0,0,1">
                        <StackPanel Orientation="Horizontal" Margin="20,0" Spacing="4">
                            <Border Classes="Tab"
                                    Classes.Active="{Binding RequestViewModel.SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Body}"
                                    PointerPressed="SelectResponseTab" Tag="Body">
                                <TextBlock Text="Body" />
                            </Border>
                            <Border Classes="Tab"
                                    Classes.Active="{Binding RequestViewModel.SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Headers}"
                                    PointerPressed="SelectResponseTab" Tag="Headers">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="Headers" />
                                    <Border Classes="Badge"
                                            IsVisible="{Binding RequestViewModel.ResponseHeadersCount, Converter={x:Static ObjectConverters.NotEqual}, ConverterParameter=0}">
                                        <TextBlock Text="{Binding RequestViewModel.ResponseHeadersCount}" />
                                    </Border>
                                </StackPanel>
                            </Border>
                            <Border Classes="Tab"
                                    Classes.Active="{Binding RequestViewModel.SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Cookies}"
                                    PointerPressed="SelectResponseTab" Tag="Cookies">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="Cookies" />
                                    <Border Classes="Badge"
                                            IsVisible="{Binding RequestViewModel.ResponseCookiesCount, Converter={x:Static ObjectConverters.NotEqual}, ConverterParameter=0}">
                                        <TextBlock Text="{Binding RequestViewModel.ResponseCookiesCount}" />
                                    </Border>
                                </StackPanel>
                            </Border>
                            <Border Classes="Tab"
                                    Classes.Active="{Binding RequestViewModel.SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Timeline}"
                                    PointerPressed="SelectResponseTab" Tag="Timeline">
                                <TextBlock Text="Timeline" />
                            </Border>
                        </StackPanel>
                    </Border>

                    <!-- Response Content -->
                    <Grid Grid.Row="2" Background="{DynamicResource BgMain}">

                        <!-- BODY TAB -->
                        <Border Background="Transparent"
                                BorderBrush="{DynamicResource BorderColor}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Margin="20"
                                ClipToBounds="True"
                                IsVisible="{Binding RequestViewModel.SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Body}">
                            <Grid>
                                <!-- Empty State -->
                                <!-- We use hardcoded value cause underneath we have avaloniaedit -->
                                <Border Background="#1A1A1A"
                                        CornerRadius="8"
                                        IsVisible="{Binding !RequestViewModel.HasResponseData}">
                                    <StackPanel VerticalAlignment="Center"
                                                HorizontalAlignment="Center"
                                                Spacing="24"
                                                Margin="60">

                                        <!-- Icon Circle -->
                                        <Border Background="{DynamicResource BgMain}"
                                                BorderBrush="{DynamicResource BorderBright}"
                                                BorderThickness="2"
                                                Width="96"
                                                Height="96"
                                                CornerRadius="48"
                                                HorizontalAlignment="Center">
                                            <lucide:Lucide Icon="FileJson"
                                                           StrokeBrush="{DynamicResource AccentBrush}"
                                                           Width="48"
                                                           Height="48"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center" />
                                        </Border>

                                        <!-- Text Content -->
                                        <StackPanel Spacing="12" HorizontalAlignment="Center">
                                            <TextBlock Text="No Response Data"
                                                       Foreground="{DynamicResource TextPrimary}"
                                                       FontSize="18"
                                                       FontWeight="SemiBold"
                                                       HorizontalAlignment="Center" />

                                            <TextBlock Text="Click 'Send' to make your first request"
                                                       Foreground="{DynamicResource TextSecondary}"
                                                       FontSize="14"
                                                       HorizontalAlignment="Center"
                                                       TextWrapping="Wrap"
                                                       TextAlignment="Center"
                                                       MaxWidth="350" />
                                        </StackPanel>
                                    </StackPanel>
                                </Border>

                                <Border Background="Transparent"
                                        CornerRadius="8"
                                        IsVisible="{Binding !RequestViewModel.HasResponseData}">
                                    <StackPanel VerticalAlignment="Center"
                                                HorizontalAlignment="Center"
                                                Spacing="24"
                                                Margin="60">

                                        <!-- Icon Circle -->
                                        <Border Background="{DynamicResource BgMain}"
                                                BorderBrush="{DynamicResource BorderBright}"
                                                BorderThickness="2"
                                                Width="96"
                                                Height="96"
                                                CornerRadius="48"
                                                HorizontalAlignment="Center">
                                            <lucide:Lucide Icon="FileJson"
                                                           StrokeBrush="{DynamicResource AccentBrush}"
                                                           Width="48"
                                                           Height="48"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center" />
                                        </Border>

                                        <!-- Text Content -->
                                        <StackPanel Spacing="12" HorizontalAlignment="Center">
                                            <TextBlock Text="No Response Data"
                                                       Foreground="{DynamicResource TextPrimary}"
                                                       FontSize="18"
                                                       FontWeight="SemiBold"
                                                       HorizontalAlignment="Center" />

                                            <TextBlock Text="Click 'Send' to make your first request"
                                                       Foreground="{DynamicResource TextSecondary}"
                                                       FontSize="14"
                                                       HorizontalAlignment="Center"
                                                       TextWrapping="Wrap"
                                                       TextAlignment="Center"
                                                       MaxWidth="350" />
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                                
                                <!-- Content with data -->
                                <Grid IsVisible="{Binding RequestViewModel.HasResponseData}">
                                    <!-- Format Menu Button -->
                                    <Button HorizontalAlignment="Right"
                                            VerticalAlignment="Top"
                                            Margin="10"
                                            ZIndex="100"
                                            Classes="ActionButton"
                                            MinWidth="0"
                                            Padding="8"
                                            ToolTip.Tip="Response Options">
                                        <lucide:Lucide Icon="Menu" Width="14" Height="14" StrokeBrush="White" />

                                        <Button.Flyout>
                                            <MenuFlyout Placement="BottomEdgeAlignedRight">
                                                <MenuItem Header="Pretty"
                                                          Command="{Binding RequestViewModel.SetPrettyFormatCommand}">
                                                    <MenuItem.Icon>
                                                        <lucide:Lucide Icon="Code"
                                                                       StrokeBrush="{DynamicResource AccentBrush}"
                                                                       Width="14" Height="14"
                                                                       IsVisible="{Binding RequestViewModel.IsPrettyActive}" />
                                                    </MenuItem.Icon>
                                                </MenuItem>
                                                <MenuItem Header="Raw"
                                                          Command="{Binding RequestViewModel.SetRawFormatCommand}">
                                                    <MenuItem.Icon>
                                                        <lucide:Lucide Icon="Text"
                                                                       StrokeBrush="{DynamicResource AccentBrush}"
                                                                       Width="14" Height="14"
                                                                       IsVisible="{Binding RequestViewModel.IsRawActive}" />
                                                    </MenuItem.Icon>
                                                </MenuItem>
                                            </MenuFlyout>
                                        </Button.Flyout>
                                    </Button>

                                    <!-- Copy Button -->
                                    <Button Classes="ActionButton"
                                            Command="{Binding RequestViewModel.CopyResponseCommand}"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Bottom"
                                            Margin="10"
                                            ZIndex="100"
                                            MinWidth="0"
                                            Padding="8"
                                            ToolTip.Tip="Copy to clipboard">
                                        <lucide:Lucide Icon="Copy" Width="14" Height="14" StrokeBrush="White" />
                                    </Button>

                                    <!-- JSON Editor -->
                                    <controls:JsonBodyEditor 
                                        Text="{Binding RequestViewModel.ResponseContent, Mode=OneWay}"
                                        MinWidth="100"
                                        MinHeight="100"
                                        IsReadOnly="True"
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Stretch" />
                                </Grid>
                            </Grid>
                        </Border>

                        <!-- HEADERS TAB -->
                        <Border Background="{DynamicResource BgElevated}"
                                BorderBrush="{DynamicResource BorderColor}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Margin="20"
                                IsVisible="{Binding RequestViewModel.SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Headers}">
                            <Grid>
                                <!-- Empty State -->
                                <Border Background="Transparent"
                                        CornerRadius="8"
                                        IsVisible="{Binding !RequestViewModel.HasResponseData}">
                                    <StackPanel VerticalAlignment="Center"
                                                HorizontalAlignment="Center"
                                                Spacing="24"
                                                Margin="60">

                                        <!-- Icon Circle -->
                                        <Border Background="{DynamicResource BgMain}"
                                                BorderBrush="{DynamicResource BorderBright}"
                                                BorderThickness="2"
                                                Width="96"
                                                Height="96"
                                                CornerRadius="48"
                                                HorizontalAlignment="Center">
                                            <lucide:Lucide Icon="ListTree"
                                                           StrokeBrush="{DynamicResource Success}"
                                                           Width="48"
                                                           Height="48"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center" />
                                        </Border>

                                        <!-- Text Content -->
                                        <StackPanel Spacing="12" HorizontalAlignment="Center">
                                            <TextBlock Text="No Response Headers"
                                                       Foreground="{DynamicResource TextPrimary}"
                                                       FontSize="18"
                                                       FontWeight="SemiBold"
                                                       HorizontalAlignment="Center" />

                                            <TextBlock
                                                Text="Send a request to view response headers"
                                                Foreground="{DynamicResource TextSecondary}"
                                                FontSize="14"
                                                HorizontalAlignment="Center"
                                                TextWrapping="Wrap"
                                                TextAlignment="Center"
                                                MaxWidth="350" />
                                        </StackPanel>
                                    </StackPanel>
                                </Border>

                                <!-- Content with data -->
                                <ScrollViewer IsVisible="{Binding RequestViewModel.HasResponseData}">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="RESPONSE HEADERS"
                                                   Classes="SectionTitle"
                                                   Margin="0,0,0,12" />

                                        <DataGrid ItemsSource="{Binding RequestViewModel.ResponseHeaders}"
                                                  Classes="ResponseGrid">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="NAME" 
                                                                    Binding="{Binding Name}" 
                                                                    Width="200" />

                                                <DataGridTextColumn Header="VALUE" 
                                                                    Binding="{Binding Value}" 
                                                                    Width="*" />
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </ScrollViewer>
                            </Grid>
                        </Border>

                        <!-- COOKIES TAB -->
                        <Border Background="{DynamicResource BgElevated}"
                                BorderBrush="{DynamicResource BorderColor}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Margin="20"
                                IsVisible="{Binding RequestViewModel.SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Cookies}">
                            <Grid>
                                <!-- Empty State -->
                                <Border Background="Transparent"
                                        CornerRadius="8"
                                        IsVisible="{Binding !RequestViewModel.HasResponseData}">
                                    <StackPanel VerticalAlignment="Center"
                                                HorizontalAlignment="Center"
                                                Spacing="24"
                                                Margin="60">

                                        <!-- Icon Circle -->
                                        <Border Background="{DynamicResource BgMain}"
                                                BorderBrush="{DynamicResource BorderBright}"
                                                BorderThickness="2"
                                                Width="96"
                                                Height="96"
                                                CornerRadius="48"
                                                HorizontalAlignment="Center">
                                            <lucide:Lucide Icon="Cookie"
                                                           StrokeBrush="{DynamicResource Warning}"
                                                           Width="48"
                                                           Height="48"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center" />
                                        </Border>

                                        <!-- Text Content -->
                                        <StackPanel Spacing="12" HorizontalAlignment="Center">
                                            <TextBlock Text="No Response Cookies"
                                                       Foreground="{DynamicResource TextPrimary}"
                                                       FontSize="18"
                                                       FontWeight="SemiBold"
                                                       HorizontalAlignment="Center" />

                                            <TextBlock Text="Send a request to view response cookies"
                                                       Foreground="{DynamicResource TextSecondary}"
                                                       FontSize="14"
                                                       HorizontalAlignment="Center"
                                                       TextWrapping="Wrap"
                                                       TextAlignment="Center"
                                                       MaxWidth="350" />
                                        </StackPanel>
                                    </StackPanel>
                                </Border>

                                <!-- Content with data -->
                                <ScrollViewer IsVisible="{Binding RequestViewModel.HasResponseData}">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="RESPONSE COOKIES"
                                                   Classes="SectionTitle"
                                                   Margin="0,0,0,12" />

                                        <DataGrid ItemsSource="{Binding RequestViewModel.ResponseCookies}"
                                                  Classes="ResponseGrid">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="NAME" 
                                                                    Binding="{Binding Name}"
                                                                    Width="200" />
                                                <DataGridTextColumn Header="VALUE" 
                                                                    Binding="{Binding Value}" 
                                                                    Width="*" />
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </ScrollViewer>
                            </Grid>
                        </Border>

                        <!-- TIMELINE TAB -->
                        <Border Background="{DynamicResource BgElevated}"
                                BorderBrush="{DynamicResource BorderColor}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Margin="20"
                                IsVisible="{Binding RequestViewModel.SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Timeline}">
                            <Grid>
                                <!-- Empty State -->
                                <Border Background="Transparent"
                                        CornerRadius="8"
                                        IsVisible="{Binding !RequestViewModel.HasResponseData}">
                                    <StackPanel VerticalAlignment="Center"
                                                HorizontalAlignment="Center"
                                                Spacing="24"
                                                Margin="60">

                                        <!-- Icon Circle -->
                                        <Border Background="{DynamicResource BgMain}"
                                                BorderBrush="{DynamicResource BorderBright}"
                                                BorderThickness="2"
                                                Width="96"
                                                Height="96"
                                                CornerRadius="48"
                                                HorizontalAlignment="Center">
                                            <lucide:Lucide Icon="Timer"
                                                           StrokeBrush="{DynamicResource AccentTeal}"
                                                           Width="48"
                                                           Height="48"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center" />
                                        </Border>

                                        <!-- Text Content -->
                                        <StackPanel Spacing="12" HorizontalAlignment="Center">
                                            <TextBlock Text="No Response Data"
                                                       Foreground="{DynamicResource TextPrimary}"
                                                       FontSize="18"
                                                       FontWeight="SemiBold"
                                                       HorizontalAlignment="Center" />

                                            <TextBlock Text="Send a request to see detailed timing breakdown"
                                                       Foreground="{DynamicResource TextSecondary}"
                                                       FontSize="14"
                                                       HorizontalAlignment="Center"
                                                       TextWrapping="Wrap"
                                                       TextAlignment="Center"
                                                       MaxWidth="350" />
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                                
                                <!-- Timeline Data -->
                                <ScrollViewer IsVisible="{Binding RequestViewModel.HasResponseData}">
                                    <StackPanel Margin="20" Spacing="20">

                                        <!-- Header -->
                                        <Border Background="{DynamicResource BgElevated}"
                                                BorderBrush="{DynamicResource BorderColor}"
                                                BorderThickness="1"
                                                CornerRadius="8"
                                                Padding="20,16">
                                            <Grid ColumnDefinitions="*, Auto">
                                                <StackPanel Grid.Column="0" Spacing="4">
                                                    <TextBlock Text="Request Timeline"
                                                               Foreground="{DynamicResource TextPrimary}"
                                                               FontSize="15"
                                                               FontWeight="SemiBold" />
                                                    <TextBlock>
                                                        <Run Text="Total Duration: "
                                                             Foreground="{DynamicResource TextSecondary}"
                                                             FontSize="13" />
                                                        <Run Text="{Binding RequestViewModel.ResponseTime}"
                                                             Foreground="{DynamicResource AccentTeal}"
                                                             FontWeight="SemiBold"
                                                             FontSize="13" />
                                                    </TextBlock>
                                                </StackPanel>
                                            </Grid>
                                        </Border>

                                        <!-- Waterfall Chart -->
                                        <Border Background="{DynamicResource BgMain}"
                                                BorderBrush="{DynamicResource BorderColor}"
                                                BorderThickness="1"
                                                CornerRadius="8"
                                                Padding="20,16">
                                            <ItemsControl
                                                ItemsSource="{Binding RequestViewModel.TimelineStages}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="Transparent"
                                                                CornerRadius="6"
                                                                Padding="8"
                                                                Margin="0,4">
                                                            <Border.Styles>
                                                                <Style Selector="Border">
                                                                    <Setter Property="Transitions">
                                                                        <Transitions>
                                                                            <BrushTransition Property="Background"
                                                                                    Duration="0:0:0.15" />
                                                                        </Transitions>
                                                                    </Setter>
                                                                </Style>
                                                                <Style Selector="Border:pointerover">
                                                                    <Setter Property="Background"
                                                                            Value="{StaticResource GlassBg}" />
                                                                </Style>
                                                            </Border.Styles>

                                                            <Grid ColumnDefinitions="150, *, 90"
                                                                  ColumnSpacing="16">

                                                                <!-- Stage Name with Color Dot -->
                                                                <Grid Grid.Column="0"
                                                                      ColumnDefinitions="Auto, *"
                                                                      ColumnSpacing="10"
                                                                      VerticalAlignment="Center">
                                                                    <Border Grid.Column="0"
                                                                            Width="12"
                                                                            Height="12"
                                                                            Background="{Binding Color}"
                                                                            CornerRadius="6"
                                                                            VerticalAlignment="Center" />
                                                                    <TextBlock Grid.Column="1"
                                                                               Text="{Binding Name}"
                                                                               Foreground="{DynamicResource TextPrimary}"
                                                                               FontSize="13"
                                                                               FontWeight="Medium"
                                                                               TextTrimming="CharacterEllipsis"
                                                                               VerticalAlignment="Center" />
                                                                </Grid>

                                                                <!-- Progress Bar Container -->
                                                                <Border Grid.Column="1"
                                                                        Height="24"
                                                                        Background="{DynamicResource BgDark}"
                                                                        CornerRadius="6"
                                                                        VerticalAlignment="Center">
                                                                    <Grid>
                                                                        <!-- The Bar -->
                                                                        <Border HorizontalAlignment="Left"
                                                                                Background="{Binding Color}"
                                                                                CornerRadius="6"
                                                                                Height="24">
                                                                            <Border.Width>
                                                                                <MultiBinding
                                                                                    Converter="{StaticResource PercentToPixelConverter}">
                                                                                    <Binding
                                                                                        Path="WidthPercent" />
                                                                                    <Binding
                                                                                        RelativeSource="{RelativeSource AncestorType=Border}"
                                                                                        Path="Bounds.Width" />
                                                                                </MultiBinding>
                                                                            </Border.Width>
                                                                        </Border>
                                                                    </Grid>
                                                                </Border>

                                                                <!-- Duration -->
                                                                <TextBlock Grid.Column="2"
                                                                           Text="{Binding DurationText}"
                                                                           Foreground="{DynamicResource TextPrimary}"
                                                                           FontWeight="SemiBold"
                                                                           FontSize="13"
                                                                           VerticalAlignment="Center"
                                                                           TextAlignment="Right" />
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </Border>
                                    </StackPanel>
                                </ScrollViewer>
                            </Grid>
                        </Border>
                    </Grid>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</UserControl>