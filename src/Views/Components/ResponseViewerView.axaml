<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewModels="clr-namespace:AvalonHttp.ViewModels"
             xmlns:lucide="clr-namespace:LucideAvalonia;assembly=LucideAvalonia"
             xmlns:controls="clr-namespace:AvalonHttp.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="AvalonHttp.Views.Components.ResponseViewerView"
             x:DataType="viewModels:RequestViewModel">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" MinHeight="150" />
        </Grid.RowDefinitions>

        <!-- Response Status Bar -->
        <Border Grid.Row="0" Background="{DynamicResource BgElevated}"
                BorderBrush="{DynamicResource BorderColor}" BorderThickness="0,0,0,1" Padding="16,12">
            <Grid ColumnDefinitions="Auto, *, Auto" ColumnSpacing="12">
                <Grid Grid.Column="0" ColumnDefinitions="Auto, Auto, Auto" ColumnSpacing="12">
                    <Border Grid.Column="0" Background="{Binding StatusBrush}" Padding="8"
                            CornerRadius="6">
                        <TextBlock Text="{Binding StatusCode}"
                                   Foreground="{DynamicResource WhiteBrush}"
                                   FontSize="11" FontWeight="SemiBold" />
                    </Border>
                    <Grid Grid.Column="1" ColumnDefinitions="Auto, Auto" ColumnSpacing="6">
                        <lucide:Lucide Grid.Column="0" Icon="Clock"
                                       StrokeBrush="{DynamicResource AccentTeal}" Width="14" Height="14"
                                       VerticalAlignment="Center" />
                        <TextBlock Grid.Column="1" Text="{Binding ResponseTime}"
                                   Foreground="{DynamicResource TextSecondary}" FontSize="12"
                                   VerticalAlignment="Center" />
                    </Grid>
                    <Grid Grid.Column="2" ColumnDefinitions="Auto, Auto" ColumnSpacing="6">
                        <lucide:Lucide Grid.Column="0" Icon="Package"
                                       StrokeBrush="{DynamicResource AccentTeal}" Width="14" Height="14"
                                       VerticalAlignment="Center" />
                        <TextBlock Grid.Column="1" Text="{Binding ResponseSize}"
                                   Foreground="{DynamicResource TextSecondary}" FontSize="12"
                                   VerticalAlignment="Center" />
                    </Grid>
                </Grid>
                <Button Grid.Column="2" IsEnabled="{Binding HasResponseData}" Classes="ActionButton"
                        ToolTip.Tip="{DynamicResource SaveResponseTooltip}" MinWidth="0"
                        Padding="8" Command="{Binding SaveResponseCommand}">
                    <lucide:Lucide Icon="Save" StrokeBrush="{DynamicResource TextPrimary}" Width="14"
                                   Height="14" />
                </Button>
            </Grid>
        </Border>

        <!-- Response Tabs -->
        <Border Grid.Row="1" Background="{DynamicResource BgElevated}"
                BorderBrush="{DynamicResource BorderColor}" BorderThickness="0,0,0,1">
            <ScrollViewer HorizontalScrollBarVisibility="Auto"
                          VerticalScrollBarVisibility="Disabled">
                <StackPanel Orientation="Horizontal" Margin="20,0" Spacing="4">
                    <Border Classes="Tab"
                            Classes.Active="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Body}"
                            PointerPressed="SelectResponseTab" Tag="Body">
                        <TextBlock Text="{DynamicResource TabBody}" />
                    </Border>
                    <Border Classes="Tab"
                            Classes.Active="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Headers}"
                            PointerPressed="SelectResponseTab" Tag="Headers">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <TextBlock Text="{DynamicResource TabHeaders}" />
                            <Border Classes="Badge"
                                    IsVisible="{Binding ResponseHeadersCount, Converter={x:Static ObjectConverters.NotEqual}, ConverterParameter=0}">
                                <TextBlock Text="{Binding ResponseHeadersCount}" />
                            </Border>
                        </StackPanel>
                    </Border>
                    <Border Classes="Tab"
                            Classes.Active="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Cookies}"
                            PointerPressed="SelectResponseTab" Tag="Cookies">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <TextBlock Text="{DynamicResource TabCookies}" />
                            <Border Classes="Badge"
                                    IsVisible="{Binding ResponseCookiesCount, Converter={x:Static ObjectConverters.NotEqual}, ConverterParameter=0}">
                                <TextBlock Text="{Binding ResponseCookiesCount}" />
                            </Border>
                        </StackPanel>
                    </Border>
                    <Border Classes="Tab"
                            Classes.Active="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Timeline}"
                            PointerPressed="SelectResponseTab" Tag="Timeline">
                        <TextBlock Text="{DynamicResource TabTimeline}" />
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Response Content -->
        <Grid Grid.Row="2" Background="{DynamicResource BgMain}">

            <!-- BODY TAB -->
            <Border Background="Transparent"
                    BorderBrush="{DynamicResource BorderColor}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Margin="20"
                    ClipToBounds="True"
                    IsVisible="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Body}">
                <Grid>
                    <!-- Empty State -->
                    <!-- We use hardcoded value cause underneath we have avaloniaedit -->
                    <Border Background="{DynamicResource BgElevated}"
                            CornerRadius="8"
                            IsVisible="{Binding !HasResponseData}">
                        <StackPanel VerticalAlignment="Center"
                                    HorizontalAlignment="Center"
                                    Spacing="24"
                                    Margin="60">

                            <!-- Icon Circle -->
                            <Border Background="{DynamicResource BgMain}"
                                    BorderBrush="{DynamicResource BorderBright}"
                                    BorderThickness="2"
                                    Width="96"
                                    Height="96"
                                    CornerRadius="48"
                                    HorizontalAlignment="Center">
                                <lucide:Lucide Icon="FileJson"
                                               StrokeBrush="{DynamicResource AccentBrush}"
                                               Width="48"
                                               Height="48"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center" />
                            </Border>

                            <!-- Text Content -->
                            <StackPanel Spacing="12" HorizontalAlignment="Center">
                                <TextBlock Text="{DynamicResource NoResponseDataTitle}"
                                           Foreground="{DynamicResource TextPrimary}"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           TextWrapping="Wrap"
                                           HorizontalAlignment="Center" />

                                <TextBlock Text="{DynamicResource NoResponseDataMessage}"
                                           Foreground="{DynamicResource TextSecondary}"
                                           FontSize="14"
                                           HorizontalAlignment="Center"
                                           TextWrapping="Wrap"
                                           TextAlignment="Center"
                                           MaxWidth="350" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <Border Background="Transparent"
                            CornerRadius="8"
                            IsVisible="{Binding HasResponseData}">
                        <StackPanel VerticalAlignment="Center"
                                    HorizontalAlignment="Center"
                                    Spacing="24"
                                    Margin="60">

                            <!-- Icon Circle -->
                            <Border Background="{DynamicResource BgMain}"
                                    BorderBrush="{DynamicResource BorderBright}"
                                    BorderThickness="2"
                                    Width="96"
                                    Height="96"
                                    CornerRadius="48"
                                    HorizontalAlignment="Center">
                                <lucide:Lucide Icon="FileJson"
                                               StrokeBrush="{DynamicResource AccentBrush}"
                                               Width="48"
                                               Height="48"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center" />
                            </Border>

                            <!-- Text Content -->
                            <StackPanel Spacing="12" HorizontalAlignment="Center">
                                <TextBlock Text="{DynamicResource NoResponseDataTitle}"
                                           Foreground="{DynamicResource TextPrimary}"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           HorizontalAlignment="Center" />

                                <TextBlock Text="{DynamicResource NoResponseDataMessage}"
                                           Foreground="{DynamicResource TextSecondary}"
                                           FontSize="14"
                                           HorizontalAlignment="Center"
                                           TextWrapping="Wrap"
                                           TextAlignment="Center"
                                           MaxWidth="350" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Content with data -->
                    <Grid IsVisible="{Binding HasResponseData}">
                        <!-- Format Menu Button -->
                        <Button HorizontalAlignment="Right"
                                VerticalAlignment="Top"
                                Margin="10"
                                ZIndex="100"
                                Classes="ActionButton"
                                MinWidth="0"
                                Padding="8"
                                ToolTip.Tip="{DynamicResource ResponseOptionsTooltip}">
                            <lucide:Lucide Icon="Menu"
                                           Width="14"
                                           Height="14"
                                           StrokeBrush="{DynamicResource TextPrimary}" />

                            <Button.Flyout>
                                <MenuFlyout Placement="BottomEdgeAlignedRight">
                                    <MenuItem Header="{DynamicResource FormatPretty}"
                                              Command="{Binding SetPrettyFormatCommand}">
                                        <MenuItem.Icon>
                                            <lucide:Lucide Icon="Code"
                                                           StrokeBrush="{DynamicResource AccentBrush}"
                                                           Width="14" Height="14"
                                                           IsVisible="{Binding IsPrettyActive}" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                    <MenuItem Header="{DynamicResource FormatRaw}"
                                              Command="{Binding SetRawFormatCommand}">
                                        <MenuItem.Icon>
                                            <lucide:Lucide Icon="Text"
                                                           StrokeBrush="{DynamicResource AccentBrush}"
                                                           Width="14" Height="14"
                                                           IsVisible="{Binding IsRawActive}" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                </MenuFlyout>
                            </Button.Flyout>
                        </Button>

                        <!-- Copy Button -->
                        <Button Classes="ActionButton"
                                Command="{Binding CopyResponseCommand}"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Bottom"
                                Margin="10"
                                ZIndex="100"
                                MinWidth="0"
                                Padding="8"
                                ToolTip.Tip="{DynamicResource CopyTooltip}">
                            <lucide:Lucide Icon="Copy"
                                           Width="14"
                                           Height="14"
                                           StrokeBrush="{DynamicResource TextPrimary}" />
                        </Button>

                        <!-- JSON Editor -->
                        <controls:JsonBodyEditor
                            Text="{Binding ResponseContent, Mode=OneWay}"
                            MinWidth="100"
                            MinHeight="100"
                            IsReadOnly="True"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch" />
                    </Grid>
                </Grid>
            </Border>

            <!-- HEADERS TAB -->
            <Border Background="{DynamicResource BgElevated}"
                    BorderBrush="{DynamicResource BorderColor}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Margin="20"
                    IsVisible="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Headers}">
                <Grid>
                    <!-- Empty State -->
                    <Border Background="Transparent"
                            CornerRadius="8"
                            IsVisible="{Binding !HasResponseData}">
                        <StackPanel VerticalAlignment="Center"
                                    HorizontalAlignment="Center"
                                    Spacing="24"
                                    Margin="60">

                            <!-- Icon Circle -->
                            <Border Background="{DynamicResource BgMain}"
                                    BorderBrush="{DynamicResource BorderBright}"
                                    BorderThickness="2"
                                    Width="96"
                                    Height="96"
                                    CornerRadius="48"
                                    HorizontalAlignment="Center">
                                <lucide:Lucide Icon="ListTree"
                                               StrokeBrush="{DynamicResource Success}"
                                               Width="48"
                                               Height="48"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center" />
                            </Border>

                            <!-- Text Content -->
                            <StackPanel Spacing="12" HorizontalAlignment="Center">
                                <TextBlock Text="{DynamicResource NoResponseHeadersTitle}"
                                           Foreground="{DynamicResource TextPrimary}"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           HorizontalAlignment="Center" />

                                <TextBlock
                                    Text="{DynamicResource NoResponseHeadersMessage}"
                                    Foreground="{DynamicResource TextSecondary}"
                                    FontSize="14"
                                    HorizontalAlignment="Center"
                                    TextWrapping="Wrap"
                                    TextAlignment="Center"
                                    MaxWidth="350" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Content with data -->
                    <Grid Margin="20" IsVisible="{Binding HasResponseData}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Text="{DynamicResource SectionResponseHeaders}"
                                   Classes="SectionTitle"
                                   Margin="0,0,0,12" />

                        <DataGrid Grid.Row="1"
                                  ItemsSource="{Binding ResponseHeaders}"
                                  Classes="ResponseGrid"
                                  HorizontalScrollBarVisibility="Visible"
                                  VerticalScrollBarVisibility="Auto">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="{DynamicResource ColName}"
                                                    Binding="{Binding Name}"
                                                    Width="Auto" />

                                <DataGridTextColumn Header="{DynamicResource ColValue}"
                                                    Binding="{Binding Value}"
                                                    Width="Auto" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Grid>
            </Border>

            <!-- COOKIES TAB -->
            <Border Background="{DynamicResource BgElevated}"
                    BorderBrush="{DynamicResource BorderColor}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Margin="20"
                    IsVisible="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Cookies}">
                <Grid>
                    <!-- Empty State -->
                    <Border Background="Transparent"
                            CornerRadius="8"
                            IsVisible="{Binding !HasResponseData}">
                        <StackPanel VerticalAlignment="Center"
                                    HorizontalAlignment="Center"
                                    Spacing="24"
                                    Margin="60">

                            <!-- Icon Circle -->
                            <Border Background="{DynamicResource BgMain}"
                                    BorderBrush="{DynamicResource BorderBright}"
                                    BorderThickness="2"
                                    Width="96"
                                    Height="96"
                                    CornerRadius="48"
                                    HorizontalAlignment="Center">
                                <lucide:Lucide Icon="Cookie"
                                               StrokeBrush="{DynamicResource Warning}"
                                               Width="48"
                                               Height="48"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center" />
                            </Border>

                            <!-- Text Content -->
                            <StackPanel Spacing="12" HorizontalAlignment="Center">
                                <TextBlock Text="{DynamicResource NoResponseCookiesTitle}"
                                           Foreground="{DynamicResource TextPrimary}"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           HorizontalAlignment="Center" />

                                <TextBlock Text="{DynamicResource NoResponseCookiesMessage}"
                                           Foreground="{DynamicResource TextSecondary}"
                                           FontSize="14"
                                           HorizontalAlignment="Center"
                                           TextWrapping="Wrap"
                                           TextAlignment="Center"
                                           MaxWidth="350" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Content with data -->
                    <ScrollViewer IsVisible="{Binding HasResponseData}">
                        <StackPanel Margin="20">
                            <TextBlock Text="{DynamicResource SectionResponseCookies}"
                                       Classes="SectionTitle"
                                       Margin="0,0,0,12" />

                            <DataGrid ItemsSource="{Binding ResponseCookies}"
                                      Classes="ResponseGrid">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="{DynamicResource ColName}"
                                                        Binding="{Binding Name}"
                                                        Width="200" />
                                    <DataGridTextColumn Header="{DynamicResource ColValue}"
                                                        Binding="{Binding Value}"
                                                        Width="*" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- TIMELINE TAB -->
            <Border Background="{DynamicResource BgElevated}"
                    BorderBrush="{DynamicResource BorderColor}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Margin="20"
                    IsVisible="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Timeline}">
                <Grid>
                    <!-- Empty State -->
                    <Border Background="Transparent"
                            CornerRadius="8"
                            IsVisible="{Binding !HasResponseData}">
                        <StackPanel VerticalAlignment="Center"
                                    HorizontalAlignment="Center"
                                    Spacing="24"
                                    Margin="60">

                            <!-- Icon Circle -->
                            <Border Background="{DynamicResource BgMain}"
                                    BorderBrush="{DynamicResource BorderBright}"
                                    BorderThickness="2"
                                    Width="96"
                                    Height="96"
                                    CornerRadius="48"
                                    HorizontalAlignment="Center">
                                <lucide:Lucide Icon="Timer"
                                               StrokeBrush="{DynamicResource AccentTeal}"
                                               Width="48"
                                               Height="48"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center" />
                            </Border>

                            <!-- Text Content -->
                            <StackPanel Spacing="12" HorizontalAlignment="Center">
                                <TextBlock Text="{DynamicResource NoResponseDataTitle}"
                                           Foreground="{DynamicResource TextPrimary}"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           HorizontalAlignment="Center" />

                                <TextBlock Text="{DynamicResource NoTimelineDataMessage}"
                                           Foreground="{DynamicResource TextSecondary}"
                                           FontSize="14"
                                           HorizontalAlignment="Center"
                                           TextWrapping="Wrap"
                                           TextAlignment="Center"
                                           MaxWidth="350" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Timeline Data -->
                    <ScrollViewer IsVisible="{Binding HasResponseData}">
                        <StackPanel Margin="20" Spacing="20">

                            <!-- Header -->
                            <Border Background="{DynamicResource BgElevated}"
                                    BorderBrush="{DynamicResource BorderColor}"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Padding="20,16">
                                <Grid ColumnDefinitions="*, Auto">
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <TextBlock Text="{DynamicResource RequestTimelineTitle}"
                                                   Foreground="{DynamicResource TextPrimary}"
                                                   FontSize="15"
                                                   FontWeight="SemiBold" />
                                        <TextBlock>
                                            <Run Text="{DynamicResource TotalDurationLabel}"
                                                 Foreground="{DynamicResource TextSecondary}"
                                                 FontSize="13" />
                                            <Run Text="{Binding ResponseTime}"
                                                 Foreground="{DynamicResource AccentTeal}"
                                                 FontWeight="SemiBold"
                                                 FontSize="13" />
                                        </TextBlock>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- Waterfall Chart -->
                            <Border Background="{DynamicResource BgMain}"
                                    BorderBrush="{DynamicResource BorderColor}"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Padding="20,16">
                                <ItemsControl
                                    ItemsSource="{Binding TimelineStages}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="Transparent"
                                                    CornerRadius="6"
                                                    Padding="8"
                                                    Margin="0,4">
                                                <Border.Styles>
                                                    <Style Selector="Border">
                                                        <Setter Property="Transitions">
                                                            <Transitions>
                                                                <BrushTransition Property="Background"
                                                                        Duration="0:0:0.15" />
                                                            </Transitions>
                                                        </Setter>
                                                    </Style>
                                                    <Style Selector="Border:pointerover">
                                                        <Setter Property="Background"
                                                                Value="{DynamicResource GlassBg}" />
                                                    </Style>
                                                </Border.Styles>

                                                <Grid ColumnDefinitions="150, *, 90"
                                                      ColumnSpacing="16">

                                                    <!-- Stage Name with Color Dot -->
                                                    <Grid Grid.Column="0"
                                                          ColumnDefinitions="Auto, *"
                                                          ColumnSpacing="10"
                                                          VerticalAlignment="Center">
                                                        <Border Grid.Column="0"
                                                                Width="12"
                                                                Height="12"
                                                                Background="{Binding Color}"
                                                                CornerRadius="6"
                                                                VerticalAlignment="Center" />
                                                        <TextBlock Grid.Column="1"
                                                                   Text="{Binding Name}"
                                                                   Foreground="{DynamicResource TextPrimary}"
                                                                   FontSize="13"
                                                                   FontWeight="Medium"
                                                                   TextTrimming="CharacterEllipsis"
                                                                   VerticalAlignment="Center" />
                                                    </Grid>

                                                    <!-- Progress Bar Container -->
                                                    <Border Grid.Column="1"
                                                            Height="24"
                                                            Background="{DynamicResource BgDark}"
                                                            CornerRadius="6"
                                                            VerticalAlignment="Center">
                                                        <Grid>
                                                            <!-- The Bar -->
                                                            <Border HorizontalAlignment="Left"
                                                                    Background="{Binding Color}"
                                                                    CornerRadius="6"
                                                                    Height="24">
                                                                <Border.Width>
                                                                    <MultiBinding
                                                                        Converter="{StaticResource PercentToPixelConverter}">
                                                                        <Binding
                                                                            Path="WidthPercent" />
                                                                        <Binding
                                                                            RelativeSource="{RelativeSource AncestorType=Border}"
                                                                            Path="Bounds.Width" />
                                                                    </MultiBinding>
                                                                </Border.Width>
                                                            </Border>
                                                        </Grid>
                                                    </Border>

                                                    <!-- Duration -->
                                                    <TextBlock Grid.Column="2"
                                                               Text="{Binding DurationText}"
                                                               Foreground="{DynamicResource TextPrimary}"
                                                               FontWeight="SemiBold"
                                                               FontSize="13"
                                                               VerticalAlignment="Center"
                                                               TextAlignment="Right" />
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>