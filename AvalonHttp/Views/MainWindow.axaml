<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AvalonHttp.ViewModels"
        xmlns:lucide="clr-namespace:LucideAvalonia;assembly=LucideAvalonia"
        xmlns:controls="clr-namespace:AvalonHttp.Controls"
        xmlns:behaviors="clr-namespace:AvalonHttp.Behaviors"
        x:Class="AvalonHttp.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="AvalonHttp"
        Width="1200" Height="750"
        MinWidth="900" MinHeight="550"
        MaxWidth="1920" MaxHeight="1080"
        Background="{DynamicResource BgDark}"
        TransparencyLevelHint="AcrylicBlur"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="PreferSystemChrome"
        WindowStartupLocation="CenterScreen"
        CanResize="True">

    <Interaction.Behaviors>
        <behaviors:ClearFocusOnClickBehavior />
    </Interaction.Behaviors>

    <Window.KeyBindings>
        <KeyBinding Gesture="Ctrl+S" Command="{Binding RequestViewModel.SaveCurrentRequestCommand}" />
    </Window.KeyBindings>

    <Panel>
        <Grid IsVisible="{Binding IsDialogOpen}" ZIndex="1000">

            <Border Background="Black" Opacity="0.5">
                <Interaction.Behaviors>
                    <EventTriggerBehavior EventName="PointerPressed">
                        <InvokeCommandAction Command="{Binding CancelConfirmCommand}" />
                    </EventTriggerBehavior>
                </Interaction.Behaviors>
            </Border>

            <Border Width="400" MinHeight="150"
                    Background="{DynamicResource BgElevated}"
                    BorderBrush="{DynamicResource BorderColor}"
                    BorderThickness="1"
                    CornerRadius="8"
                    BoxShadow="0 4 20 0 #40000000"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Padding="24">
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <lucide:Lucide Icon="OctagonAlert" StrokeBrush="#EF4444" Width="24" Height="24" />
                        <TextBlock Text="{Binding DialogTitle}"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center" />
                    </StackPanel>

                    <TextBlock Text="{Binding DialogMessage}"
                               Foreground="{DynamicResource TextSecondary}"
                               TextWrapping="Wrap"
                               LineHeight="20" />

                    <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right" Margin="0,8,0,0">
                        <Button Content="Cancel"
                                Command="{Binding CancelConfirmCommand}"
                                Background="Transparent"
                                BorderBrush="{DynamicResource BorderColor}"
                                BorderThickness="1"
                                CornerRadius="6"
                                Padding="16,8"
                                Cursor="Hand" />

                        <Button Content="{Binding ConfirmButtonText}"
                                Command="{Binding ExecuteConfirmCommand}"
                                Background="#EF4444"
                                Foreground="White"
                                CornerRadius="6"
                                Padding="16,8"
                                FontWeight="Medium"
                                Cursor="Hand" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Custom Title Bar -->
        <Border Height="40"
                VerticalAlignment="Top"
                Background="{DynamicResource BgElevated}"
                BorderBrush="{DynamicResource BorderColor}"
                BorderThickness="0,0,0,1"
                IsHitTestVisible="False">
            <Grid ColumnDefinitions="*, Auto" IsHitTestVisible="False">
                <StackPanel Grid.Column="0"
                            Orientation="Horizontal"
                            Spacing="12"
                            Margin="16,0"
                            VerticalAlignment="Center">
                    <lucide:Lucide Icon="Zap" StrokeBrush="{DynamicResource AccentBrush}" Width="16" Height="16" />
                    <TextBlock Text="AvalonHttp"
                               Foreground="{DynamicResource TextPrimary}"
                               FontWeight="SemiBold"
                               FontSize="13"
                               VerticalAlignment="Center" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content with adaptive columns -->
        <Grid Margin="0,40,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="60" MinWidth="60" MaxWidth="60" />
                <ColumnDefinition Width="280" MinWidth="200" MaxWidth="350" />
                <ColumnDefinition Width="*" MinWidth="400" />
            </Grid.ColumnDefinitions>

            <!-- LEFT SIDEBAR - SLIM NAVIGATION -->
            <Border Grid.Column="0" Background="{DynamicResource BgSidebarBrush}"
                    BorderBrush="{DynamicResource BorderColor}" BorderThickness="0,0,1,0">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Bottom" Margin="10,0,10,20" Spacing="12">
                        <Button Classes="NavIcon">
                            <lucide:Lucide Icon="Settings" StrokeBrush="White" Width="20" Height="20" />
                        </Button>
                    </StackPanel>

                    <ScrollViewer>
                        <StackPanel Spacing="12" Margin="10,20">
                            <Button Classes="NavIcon Active">
                                <lucide:Lucide Icon="FolderOpen" StrokeBrush="White" Width="20" Height="20" />
                            </Button>
                            <Button Classes="NavIcon">
                                <lucide:Lucide Icon="Search" StrokeBrush="White" Width="20" Height="20" />
                            </Button>
                            <Button Classes="NavIcon">
                                <lucide:Lucide Icon="Zap" StrokeBrush="White" Width="20" Height="20" />
                            </Button>

                            <Border Height="1" Background="{DynamicResource BorderColor}" Margin="5,8" />

                            <Button Classes="NavIcon">
                                <lucide:Lucide Icon="ChartBar" StrokeBrush="White" Width="20" Height="20" />
                            </Button>
                            <Button Classes="NavIcon">
                                <lucide:Lucide Icon="Wrench" StrokeBrush="White" Width="20" Height="20" />
                            </Button>
                        </StackPanel>
                    </ScrollViewer>
                </DockPanel>
            </Border>

            <!-- COLLECTIONS PANEL -->
            <Border Grid.Column="1" Background="{DynamicResource BgSidebarBrush}"
                    BorderBrush="{DynamicResource BorderColor}" BorderThickness="0,0,1,0">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Margin="20,20,20,16" Spacing="12">
                        <Grid ColumnDefinitions="*, Auto">
                            <TextBlock Text="COLLECTIONS"
                                       Grid.Column="0"
                                       Foreground="{DynamicResource TextSecondary}"
                                       FontSize="11"
                                       FontWeight="SemiBold"
                                       LetterSpacing="1" />

                            <Button Grid.Column="1"
                                    Classes="IconButton"
                                    Command="{Binding CollectionsViewModel.CreateCollectionCommand}"
                                    ToolTip.Tip="New Collection">
                                <lucide:Lucide Icon="Plus"
                                               StrokeBrush="{DynamicResource TextSecondary}"
                                               Width="16" Height="16" />
                            </Button>
                        </Grid>

                        <TextBox Watermark="Search collections..." />
                    </StackPanel>

                    <ScrollViewer>
                        <ItemsControl ItemsSource="{Binding CollectionsViewModel.Collections}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="0,4">
                                        <!-- Collection Header -->
                                        <Border Classes="TreeItem">
                                            <Interaction.Behaviors>
                                                <behaviors:DragDropBehavior />
                                            </Interaction.Behaviors>
                                            <Grid ColumnDefinitions="Auto, *, Auto">
                                                <!-- Expand Icon -->
                                                <Button Grid.Column="0"
                                                        Classes="IconButton"
                                                        Command="{Binding ToggleExpandCommand}"
                                                        Padding="4">
                                                    <lucide:Lucide Icon="ChevronDown"
                                                                   Width="14" Height="14"
                                                                   StrokeBrush="{DynamicResource TextSecondary}">
                                                        <lucide:Lucide.RenderTransform>
                                                            <RotateTransform
                                                                Angle="{Binding IsExpanded, Converter={StaticResource BoolToAngleConverter}}" />
                                                        </lucide:Lucide.RenderTransform>
                                                    </lucide:Lucide>
                                                </Button>

                                                <!-- Collection Name -->
                                                <Grid Grid.Column="1"
                                                      ColumnDefinitions="Auto, *"
                                                      Margin="4,0"
                                                      VerticalAlignment="Center"
                                                      Background="Transparent">
                                                    <Grid.Styles>
                                                        <Style Selector="Grid">
                                                            <Setter Property="Cursor" Value="Hand" />
                                                        </Style>
                                                    </Grid.Styles>

                                                    <Interaction.Behaviors>
                                                        <EventTriggerBehavior EventName="DoubleTapped">
                                                            <InvokeCommandAction Command="{Binding StartRenameCommand}" />
                                                        </EventTriggerBehavior>
                                                    </Interaction.Behaviors>

                                                    <lucide:Lucide Grid.Column="0"
                                                                   Icon="Folder"
                                                                   StrokeBrush="#F59E0B"
                                                                   Width="16" Height="16"
                                                                   Margin="0,0,8,0" />

                                                    <!-- Edit Mode -->
                                                    <TextBox Grid.Column="1"
                                                             Text="{Binding Name}"
                                                             IsVisible="{Binding IsEditing}"
                                                             BorderThickness="0"
                                                             Background="Transparent">
                                                        <TextBox.KeyBindings>
                                                            <KeyBinding Gesture="Enter"
                                                                        Command="{Binding FinishRenameCommand}" />
                                                            <KeyBinding Gesture="Escape"
                                                                        Command="{Binding FinishRenameCommand}" />
                                                        </TextBox.KeyBindings>

                                                        <Interaction.Behaviors>
                                                            <EventTriggerBehavior EventName="LostFocus">
                                                                <InvokeCommandAction
                                                                    Command="{Binding FinishRenameCommand}" />
                                                            </EventTriggerBehavior>
                                                        </Interaction.Behaviors>
                                                    </TextBox>

                                                    <!-- View Mode -->
                                                    <TextBlock Grid.Column="1"
                                                               Text="{Binding Name}"
                                                               IsVisible="{Binding !IsEditing}"
                                                               VerticalAlignment="Center"
                                                               TextTrimming="CharacterEllipsis" />
                                                </Grid>

                                                <!-- Context Menu Button -->
                                                <Button Grid.Column="2"
                                                        Classes="IconButton"
                                                        Padding="4">
                                                    <lucide:Lucide Icon="Menu"
                                                                   Width="14" Height="14"
                                                                   StrokeBrush="{DynamicResource TextSecondary}" />

                                                    <Button.Flyout>
                                                        <MenuFlyout>
                                                            <MenuItem Header="Rename"
                                                                      Command="{Binding StartRenameCommand}">
                                                                <MenuItem.Icon>
                                                                    <lucide:Lucide Icon="Pencil" Width="14" Height="14" />
                                                                </MenuItem.Icon>
                                                            </MenuItem>
                                                            <MenuItem Header="Add Request"
                                                                      Command="{Binding AddRequestCommand}">
                                                                <MenuItem.Icon>
                                                                    <lucide:Lucide Icon="Plus" Width="14" Height="14" />
                                                                </MenuItem.Icon>
                                                            </MenuItem>
                                                            <MenuItem Header="Duplicate"
                                                                      Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).CollectionsViewModel.DuplicateCollectionCommand}"
                                                                      CommandParameter="{Binding}">
                                                                <MenuItem.Icon>
                                                                    <lucide:Lucide Icon="Copy" Width="14" Height="14" />
                                                                </MenuItem.Icon>
                                                            </MenuItem>
                                                            <Separator />
                                                            <MenuItem Header="Delete"
                                                                      Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).CollectionsViewModel.DeleteCollectionCommand}"
                                                                      CommandParameter="{Binding}">
                                                                <MenuItem.Icon>
                                                                    <lucide:Lucide Icon="Trash2" Width="14" Height="14" />
                                                                </MenuItem.Icon>
                                                            </MenuItem>
                                                        </MenuFlyout>
                                                    </Button.Flyout>
                                                </Button>
                                            </Grid>
                                        </Border>

                                        <!-- Requests List -->
                                        <ItemsControl ItemsSource="{Binding Requests}"
                                                      IsVisible="{Binding IsExpanded}"
                                                      Margin="24,0,0,0">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Classes="TreeItem"
                                                            Classes.Active="{Binding IsSelected}"
                                                            Margin="0,2">
                                                        <Interaction.Behaviors>
                                                            <behaviors:DragDropBehavior />
                                                        </Interaction.Behaviors>
                                                        <Grid ColumnDefinitions="Auto, *, Auto">
                                                            <!-- Method Badge -->
                                                            <Border Grid.Column="0"
                                                                    Classes="MethodBadge"
                                                                    Margin="0,0,8,0"
                                                                    Background="{Binding Method, Converter={StaticResource MethodToBrushConverter}, ConverterParameter=Bg}">

                                                                <TextBlock Text="{Binding Method}"
                                                                           Foreground="{Binding Method, Converter={StaticResource MethodToBrushConverter}, ConverterParameter=Fg}" />
                                                            </Border>

                                                            <!-- Request Name - Edit Mode -->
                                                            <TextBox Grid.Column="1"
                                                                     Text="{Binding Name}"
                                                                     IsVisible="{Binding IsEditing}"
                                                                     BorderThickness="0"
                                                                     Background="Transparent">
                                                                <TextBox.KeyBindings>
                                                                    <KeyBinding Gesture="Enter"
                                                                            Command="{Binding FinishRenameCommand}" />
                                                                    <KeyBinding Gesture="Escape"
                                                                            Command="{Binding CancelRenameCommand}" />
                                                                </TextBox.KeyBindings>
                                                                
                                                                <Interaction.Behaviors>
                                                                    <EventTriggerBehavior EventName="LostFocus">
                                                                        <InvokeCommandAction
                                                                            Command="{Binding FinishRenameCommand}" />
                                                                    </EventTriggerBehavior>
                                                                </Interaction.Behaviors>
                                                            </TextBox>

                                                            <!-- Request Name - View Mode -->
                                                            <Grid Grid.Column="1"
                                                                  ColumnDefinitions="*, Auto"
                                                                  IsVisible="{Binding !IsEditing}"
                                                                  ColumnSpacing="6">
                                                                <Border Grid.Column="0" Background="Transparent"
                                                                        Cursor="Hand">
                                                                    <Interaction.Behaviors>
                                                                        <EventTriggerBehavior EventName="DoubleTapped">
                                                                            <InvokeCommandAction
                                                                                Command="{Binding StartRenameCommand}" />
                                                                        </EventTriggerBehavior>
                                                                        <EventTriggerBehavior EventName="Tapped">
                                                                            <InvokeCommandAction
                                                                                Command="{Binding SelectCommand}" />
                                                                        </EventTriggerBehavior>
                                                                    </Interaction.Behaviors>

                                                                    <TextBlock Text="{Binding Name}"
                                                                               VerticalAlignment="Center"
                                                                               TextTrimming="CharacterEllipsis" />
                                                                </Border>

                                                                <!-- Unsaved indicator -->
                                                                <Border Grid.Column="1"
                                                                        Width="6" Height="6"
                                                                        CornerRadius="3"
                                                                        Background="{DynamicResource AccentBrush}"
                                                                        VerticalAlignment="Center"
                                                                        IsVisible="{Binding IsDirty}"
                                                                        ToolTip.Tip="Unsaved changes" />
                                                            </Grid>

                                                            <!-- Context Menu -->
                                                            <Button Grid.Column="2"
                                                                    Classes="IconButton"
                                                                    Padding="4">
                                                                <lucide:Lucide Icon="Menu"
                                                                               Width="12" Height="12"
                                                                               StrokeBrush="{DynamicResource TextSecondary}" />

                                                                <Button.Flyout>
                                                                    <MenuFlyout>
                                                                        <MenuItem Header="Rename"
                                                                                Command="{Binding StartRenameCommand}">
                                                                            <MenuItem.Icon>
                                                                                <lucide:Lucide Icon="Pencil" Width="14"
                                                                                    Height="14" />
                                                                            </MenuItem.Icon>
                                                                        </MenuItem>
                                                                        <MenuItem Header="Duplicate"
                                                                                Command="{Binding DuplicateCommand}">
                                                                            <MenuItem.Icon>
                                                                                <lucide:Lucide Icon="Copy" Width="14"
                                                                                    Height="14" />
                                                                            </MenuItem.Icon>
                                                                        </MenuItem>
                                                                        <Separator />
                                                                        <MenuItem Header="Delete"
                                                                                Command="{Binding DeleteCommand}">
                                                                            <MenuItem.Icon>
                                                                                <lucide:Lucide Icon="Trash2" Width="14"
                                                                                    Height="14" />
                                                                            </MenuItem.Icon>
                                                                        </MenuItem>
                                                                    </MenuFlyout>
                                                                </Button.Flyout>
                                                            </Button>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </DockPanel>
            </Border>


            <!-- MAIN CONTENT AREA -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" MinHeight="200" />
                </Grid.RowDefinitions>

                <!-- REQUEST BAR -->
                <Border Grid.Row="0"
                        Background="{DynamicResource BgElevated}"
                        BorderBrush="{DynamicResource BorderColor}"
                        BorderThickness="0,0,0,1"
                        Padding="20,16">
                    <Grid RowDefinitions="Auto, Auto" RowSpacing="12">

                        <!-- Name Row -->
                        <Grid Grid.Row="0" ColumnDefinitions="Auto, *, Auto" ColumnSpacing="8">
                            <lucide:Lucide Grid.Column="0"
                                           Icon="File"
                                           StrokeBrush="{DynamicResource TextSecondary}"
                                           Width="14" Height="14"
                                           VerticalAlignment="Center" />

                            <TextBox Grid.Column="1"
                                     Text="{Binding RequestViewModel.Name, Mode=TwoWay}"
                                     BorderThickness="0"
                                     Background="Transparent"
                                     Foreground="{DynamicResource TextPrimary}"
                                     FontWeight="Medium"
                                     FontSize="13"
                                     VerticalAlignment="Center" />

                            <Border Grid.Column="2"
                                    Width="8" Height="8"
                                    CornerRadius="4"
                                    Background="{DynamicResource AccentBrush}"
                                    VerticalAlignment="Center"
                                    IsVisible="{Binding RequestViewModel.IsDirty}"
                                    ToolTip.Tip="Unsaved changes (Ctrl+S)" />
                        </Grid>

                        <!-- URL Row -->
                        <Grid Grid.Row="1" ColumnDefinitions="Auto, *, Auto" ColumnSpacing="12">
                            <ComboBox Grid.Column="0"
                                      SelectedItem="{Binding RequestViewModel.SelectedMethod}"
                                      ItemsSource="{Binding HttpMethods}"
                                      Classes="MethodDropdown"
                                      MinWidth="90" />

                            <TextBox Grid.Column="1"
                                     Text="{Binding RequestViewModel.RequestUrl}"
                                     Watermark="Enter request URL..."
                                     Classes="UrlInput" />

                            <Button Grid.Column="2"
                                    Classes="SendButton"
                                    Command="{Binding RequestViewModel.SendRequestCommand}">
                                <Grid ColumnDefinitions="Auto, Auto" ColumnSpacing="8">
                                    <lucide:Lucide Grid.Column="0"
                                                   Icon="Send"
                                                   StrokeBrush="White"
                                                   Width="16" Height="16" />
                                    <TextBlock Grid.Column="1" Text="Send" />
                                </Grid>
                            </Button>
                        </Grid>
                    </Grid>
                </Border>

                <!-- TABS -->
                <Border Grid.Row="1" Background="{DynamicResource BgElevated}"
                        BorderBrush="{DynamicResource BorderColor}"
                        BorderThickness="0,0,0,1">
                    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                        <StackPanel Orientation="Horizontal" Margin="20,0" Spacing="4">
                            <Border Classes="Tab"
                                    Classes.Active="{Binding SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Params}"
                                    PointerPressed="SelectRequestTab" Tag="Params">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="Params" />
                                    <Border Classes="Badge"
                                            IsVisible="{Binding RequestViewModel.QueryParamsViewModel.EnabledParametersCount, Converter={x:Static ObjectConverters.NotEqual}, ConverterParameter=0}">
                                        <TextBlock
                                            Text="{Binding RequestViewModel.QueryParamsViewModel.EnabledParametersCount}" />
                                    </Border>
                                </StackPanel>
                            </Border>

                            <Border Classes="Tab"
                                    Classes.Active="{Binding SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Auth}"
                                    PointerPressed="SelectRequestTab" Tag="Auth">
                                <TextBlock Text="Auth" />
                            </Border>

                            <Border Classes="Tab"
                                    Classes.Active="{Binding SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Headers}"
                                    PointerPressed="SelectRequestTab" Tag="Headers">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="Headers" />
                                    <Border Classes="Badge"
                                            IsVisible="{Binding RequestViewModel.HeadersViewModel.EnabledHeadersCount, Converter={x:Static ObjectConverters.NotEqual}, ConverterParameter=0}">
                                        <TextBlock
                                            Text="{Binding RequestViewModel.HeadersViewModel.EnabledHeadersCount}" />
                                    </Border>
                                </StackPanel>
                            </Border>

                            <Border Classes="Tab"
                                    Classes.Active="{Binding SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Body}"
                                    PointerPressed="SelectRequestTab" Tag="Body">
                                <TextBlock Text="Body" />
                            </Border>

                        </StackPanel>
                    </ScrollViewer>
                </Border>

                <!-- CONTENT SPLIT -->
                <Grid Grid.Row="2">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" MinWidth="300" MaxWidth="600" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" MinWidth="350" />
                    </Grid.ColumnDefinitions>

                    <!-- LEFT: REQUEST PANEL -->
                    <ScrollViewer Grid.Column="0" Background="{DynamicResource BgMain}">
                        <StackPanel Margin="20" Spacing="24">

                            <!-- PARAMS TAB CONTENT -->
                            <StackPanel
                                IsVisible="{Binding SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Params}">
                                <TextBlock Text="QUERY PARAMETERS" Classes="SectionTitle" />

                                <ItemsControl ItemsSource="{Binding RequestViewModel.QueryParamsViewModel.Parameters}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Grid ColumnSpacing="12" Margin="0,6">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="40" />
                                                    <ColumnDefinition Width="*" MinWidth="60" />
                                                    <ColumnDefinition Width="*" MinWidth="60" />
                                                    <ColumnDefinition Width="40" />
                                                </Grid.ColumnDefinitions>

                                                <CheckBox Grid.Column="0" IsChecked="{Binding IsEnabled}" />
                                                <TextBox Grid.Column="1" Text="{Binding Key}" Classes="KvInput"
                                                         Watermark="Param name" />
                                                <TextBox Grid.Column="2" Text="{Binding Value}" Classes="KvInput"
                                                         Watermark="Value" />
                                                <Button Grid.Column="3" Classes="IconButton"
                                                        Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).RequestViewModel.QueryParamsViewModel.RemoveParameterCommand}"
                                                        CommandParameter="{Binding}">
                                                    <lucide:Lucide Icon="Trash2"
                                                                   StrokeBrush="{DynamicResource TextMuted}"
                                                                   Width="16" Height="16" />
                                                </Button>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <Button Classes="AddRowButton"
                                        Margin="0,12,0,0"
                                        Command="{Binding RequestViewModel.QueryParamsViewModel.AddParameterCommand}">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <lucide:Lucide Icon="Plus" StrokeBrush="{DynamicResource TextSecondary}"
                                                       Width="14" Height="14" />
                                        <TextBlock Text="Add Parameter" VerticalAlignment="Center" />
                                    </StackPanel>
                                </Button>
                            </StackPanel>

                            <!-- AUTH TAB CONTENT -->
                            <StackPanel
                                IsVisible="{Binding SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Auth}">
                                <TextBlock Text="AUTHORIZATION" Classes="SectionTitle" Margin="0,0,0,12" />

                                <!-- Auth Type Selector -->
                                <TextBlock Text="Auth Type"
                                           Foreground="{DynamicResource TextSecondary}"
                                           FontSize="12"
                                           Margin="0,0,0,6" />
                                <ComboBox SelectedItem="{Binding RequestViewModel.AuthViewModel.SelectedAuthType}"
                                          ItemsSource="{Binding RequestViewModel.AuthViewModel.AuthTypes}"
                                          MinWidth="200"
                                          Margin="0,0,0,20" />

                                <!-- BASIC AUTH -->
                                <StackPanel
                                    IsVisible="{Binding RequestViewModel.AuthViewModel.SelectedAuthType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Basic Auth'}"
                                    Spacing="12">
                                    <TextBlock Text="Username"
                                               Foreground="{DynamicResource TextSecondary}"
                                               FontSize="12" />
                                    <TextBox Text="{Binding RequestViewModel.AuthViewModel.BasicUsername}"
                                             Watermark="Enter username"
                                             Classes="KvInput" />

                                    <TextBlock Text="Password"
                                               Foreground="{DynamicResource TextSecondary}"
                                               FontSize="12" />
                                    <TextBox Text="{Binding RequestViewModel.AuthViewModel.BasicPassword}"
                                             Watermark="Enter password"
                                             PasswordChar="â—"
                                             Classes="KvInput" />
                                </StackPanel>

                                <!-- BEARER TOKEN -->
                                <StackPanel
                                    IsVisible="{Binding RequestViewModel.AuthViewModel.SelectedAuthType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='Bearer Token'}"
                                    Spacing="12">
                                    <TextBlock Text="Token"
                                               Foreground="{DynamicResource TextSecondary}"
                                               FontSize="12" />
                                    <TextBox Text="{Binding RequestViewModel.AuthViewModel.BearerToken}"
                                             Watermark="Enter bearer token"
                                             Classes="KvInput"
                                             MinHeight="80"
                                             AcceptsReturn="True"
                                             TextWrapping="Wrap" />
                                </StackPanel>

                                <!-- API KEY -->
                                <StackPanel
                                    IsVisible="{Binding RequestViewModel.AuthViewModel.SelectedAuthType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter='API Key'}"
                                    Spacing="12">
                                    <TextBlock Text="Key Name"
                                               Foreground="{DynamicResource TextSecondary}"
                                               FontSize="12" />
                                    <TextBox Text="{Binding RequestViewModel.AuthViewModel.ApiKeyName}"
                                             Watermark="e.g. X-API-Key"
                                             Classes="KvInput" />

                                    <TextBlock Text="Key Value"
                                               Foreground="{DynamicResource TextSecondary}"
                                               FontSize="12" />
                                    <TextBox Text="{Binding RequestViewModel.AuthViewModel.ApiKeyValue}"
                                             Watermark="Enter API key"
                                             Classes="KvInput" />

                                    <TextBlock Text="Add To"
                                               Foreground="{DynamicResource TextSecondary}"
                                               FontSize="12" />
                                    <ComboBox SelectedItem="{Binding RequestViewModel.AuthViewModel.ApiKeyLocation}"
                                              ItemsSource="{Binding RequestViewModel.AuthViewModel.ApiKeyLocations}"
                                              MinWidth="200" />
                                </StackPanel>

                                <!-- NONE MESSAGE -->
                                <StackPanel
                                    IsVisible="{Binding RequestViewModel.AuthViewModel.SelectedAuthType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=None}"
                                    Spacing="8">
                                    <Border Background="{DynamicResource BgElevated}"
                                            BorderBrush="{DynamicResource BorderColor}"
                                            BorderThickness="1"
                                            CornerRadius="6"
                                            Padding="16">
                                        <StackPanel Spacing="8">
                                            <lucide:Lucide Icon="ShieldOff"
                                                           StrokeBrush="{DynamicResource TextMuted}"
                                                           Width="32"
                                                           Height="32"
                                                           HorizontalAlignment="Center" />
                                            <TextBlock Text="No authentication"
                                                       Foreground="{DynamicResource TextPrimary}"
                                                       FontSize="14"
                                                       FontWeight="Medium"
                                                       HorizontalAlignment="Center" />
                                            <TextBlock Text="This request will be sent without authentication"
                                                       Foreground="{DynamicResource TextMuted}"
                                                       FontSize="12"
                                                       TextWrapping="Wrap"
                                                       HorizontalAlignment="Center" />
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </StackPanel>

                            <!-- HEADERS TAB CONTENT -->
                            <StackPanel
                                IsVisible="{Binding SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Headers}">
                                <TextBlock Text="REQUEST HEADERS" Classes="SectionTitle" />

                                <ItemsControl ItemsSource="{Binding RequestViewModel.HeadersViewModel.Headers}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Grid ColumnSpacing="12" Margin="0,6">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="40" />
                                                    <ColumnDefinition Width="*" MinWidth="80" />
                                                    <ColumnDefinition Width="*" MinWidth="80" />
                                                    <ColumnDefinition Width="40" />
                                                </Grid.ColumnDefinitions>

                                                <CheckBox Grid.Column="0" IsChecked="{Binding IsEnabled}" />
                                                <TextBox Grid.Column="1" Text="{Binding Key}" Classes="KvInput"
                                                         Watermark="Header name" />
                                                <TextBox Grid.Column="2" Text="{Binding Value}" Classes="KvInput"
                                                         Watermark="Value" />
                                                <Button Grid.Column="3" Classes="IconButton"
                                                        Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).RequestViewModel.HeadersViewModel.RemoveHeaderCommand}"
                                                        CommandParameter="{Binding}">
                                                    <lucide:Lucide Icon="Trash2"
                                                                   StrokeBrush="{DynamicResource TextMuted}"
                                                                   Width="16" Height="16" />
                                                </Button>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <Button Classes="AddRowButton"
                                        Margin="0,12,0,0"
                                        Command="{Binding RequestViewModel.HeadersViewModel.AddHeaderCommand}">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <lucide:Lucide Icon="Plus" StrokeBrush="{DynamicResource TextSecondary}"
                                                       Width="14" Height="14" />
                                        <TextBlock Text="Add Header" />
                                    </StackPanel>
                                </Button>
                            </StackPanel>

                            <!-- BODY TAB CONTENT -->
                            <StackPanel
                                IsVisible="{Binding SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Body}">
                                <TextBlock Text="REQUEST BODY" Classes="SectionTitle" />

                                <controls:JsonBodyEditor
                                    Text="{Binding RequestViewModel.RequestBody}"
                                    MinHeight="300"
                                    Margin="0,12,0,0" />
                            </StackPanel>

                            <!-- PRE-REQUEST TAB CONTENT -->
                            <StackPanel
                                IsVisible="{Binding SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=PreRequest}">
                                <TextBlock Text="PRE-REQUEST SCRIPT" Classes="SectionTitle" />
                                <TextBlock Text="Pre-request script features coming soon..."
                                           Foreground="{DynamicResource TextMuted}"
                                           FontSize="13"
                                           Margin="0,12,0,0" />
                            </StackPanel>

                            <!-- TESTS TAB CONTENT -->
                            <StackPanel
                                IsVisible="{Binding SelectedRequestTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Tests}">
                                <TextBlock Text="TESTS" Classes="SectionTitle" />
                                <TextBlock Text="Test script features coming soon..."
                                           Foreground="{DynamicResource TextMuted}"
                                           FontSize="13"
                                           Margin="0,12,0,0" />
                            </StackPanel>

                        </StackPanel>
                    </ScrollViewer>

                    <!-- SPLITTER -->
                    <GridSplitter Grid.Column="1"
                                  Width="5"
                                  Background="{DynamicResource BorderColor}"
                                  ResizeDirection="Columns"
                                  ResizeBehavior="PreviousAndNext" />

                    <!-- RIGHT: RESPONSE PANEL -->
                    <Grid Grid.Column="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" MinHeight="150" />
                        </Grid.RowDefinitions>

                        <!-- STATUS BAR -->
                        <Border Grid.Row="0"
                                Background="{DynamicResource BgElevated}"
                                BorderBrush="{DynamicResource BorderColor}"
                                BorderThickness="0,0,0,1"
                                Padding="16,12">
                            <Grid ColumnDefinitions="Auto, *, Auto" ColumnSpacing="12">

                                <!-- Left: Status + Metrics -->
                                <Grid Grid.Column="0" ColumnDefinitions="Auto, Auto, Auto" ColumnSpacing="12">
                                    <!-- Status Badge -->
                                    <Border Grid.Column="0"
                                            Background="{Binding RequestViewModel.StatusBrush}"
                                            Padding="8"
                                            CornerRadius="6">
                                        <TextBlock Text="{Binding RequestViewModel.StatusCode}"
                                                   Foreground="White"
                                                   FontSize="11"
                                                   FontWeight="SemiBold" />
                                    </Border>

                                    <!-- Time -->
                                    <Grid Grid.Column="1" ColumnDefinitions="Auto, Auto" ColumnSpacing="6">
                                        <lucide:Lucide Grid.Column="0"
                                                       Icon="Clock"
                                                       StrokeBrush="{DynamicResource AccentTeal}"
                                                       Width="14" Height="14"
                                                       VerticalAlignment="Center" />
                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding RequestViewModel.ResponseTime}"
                                                   Foreground="{DynamicResource TextSecondary}"
                                                   FontSize="12"
                                                   VerticalAlignment="Center" />
                                    </Grid>

                                    <!-- Size -->
                                    <Grid Grid.Column="2" ColumnDefinitions="Auto, Auto" ColumnSpacing="6">
                                        <lucide:Lucide Grid.Column="0"
                                                       Icon="Package"
                                                       StrokeBrush="{DynamicResource AccentTeal}"
                                                       Width="14" Height="14"
                                                       VerticalAlignment="Center" />
                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding RequestViewModel.ResponseSize}"
                                                   Foreground="{DynamicResource TextSecondary}"
                                                   FontSize="12"
                                                   VerticalAlignment="Center" />
                                    </Grid>
                                </Grid>

                                <!-- Right: Save Button -->
                                <Button Grid.Column="2"
                                        Classes="ActionButton"
                                        ToolTip.Tip="Save Changes"
                                        MinWidth="0"
                                        Padding="8"
                                        Command="{Binding RequestViewModel.SaveCurrentRequestCommand}">
                                    <lucide:Lucide Icon="Save"
                                                   StrokeBrush="{DynamicResource TextSecondary}"
                                                   Width="14" Height="14" />
                                </Button>
                            </Grid>
                        </Border>

                        <!-- RESPONSE TABS -->
                        <Border Grid.Row="1" Background="{DynamicResource BgElevated}"
                                BorderBrush="{DynamicResource BorderColor}"
                                BorderThickness="0,0,0,1">
                            <StackPanel Orientation="Horizontal" Margin="20,0" Spacing="4">
                                <Border Classes="Tab"
                                        Classes.Active="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Body}"
                                        PointerPressed="SelectResponseTab" Tag="Body">
                                    <TextBlock Text="Body" />
                                </Border>
                                <Border Classes="Tab"
                                        Classes.Active="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Headers}"
                                        PointerPressed="SelectResponseTab" Tag="Headers">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <TextBlock Text="Headers" />
                                        <Border Classes="Badge">
                                            <TextBlock Text="{Binding RequestViewModel.ResponseHeadersCount}" />
                                        </Border>
                                    </StackPanel>
                                </Border>
                                <Border Classes="Tab"
                                        Classes.Active="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Cookies}"
                                        PointerPressed="SelectResponseTab" Tag="Cookies">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <TextBlock Text="Cookies" />
                                        <Border Classes="Badge">
                                            <TextBlock Text="{Binding RequestViewModel.ResponseCookiesCount}" />
                                        </Border>
                                    </StackPanel>
                                </Border>
                                <Border Classes="Tab"
                                        Classes.Active="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Timeline}"
                                        PointerPressed="SelectResponseTab" Tag="Timeline">
                                    <TextBlock Text="Timeline" />
                                </Border>
                            </StackPanel>
                        </Border>
                        <!-- RESPONSE CONTENT -->
                        <!-- RESPONSE CONTENT -->
                        <Grid Grid.Row="2" Background="{DynamicResource BgMain}">

                            <!-- BODY TAB -->
                            <Border Background="Transparent"
                                    BorderBrush="{DynamicResource BorderColor}"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Margin="20"
                                    ClipToBounds="True"
                                    IsVisible="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Body}">
                                <Grid>
                                    <!-- Empty State -->
                                    <Border Background="#1A1A1A"
                                            CornerRadius="12"
                                            IsVisible="{Binding !RequestViewModel.HasResponseData}">
                                        <StackPanel VerticalAlignment="Center"
                                                    HorizontalAlignment="Center"
                                                    Spacing="20"
                                                    Margin="40">

                                            <Border Background="#252526"
                                                    Width="80"
                                                    Height="80"
                                                    CornerRadius="40"
                                                    HorizontalAlignment="Center">
                                                <lucide:Lucide Icon="FileJson"
                                                               StrokeBrush="#3B82F6"
                                                               Width="40"
                                                               Height="40"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center" />
                                            </Border>

                                            <StackPanel Spacing="8" HorizontalAlignment="Center">
                                                <TextBlock Text="No Response"
                                                           Foreground="#FFFFFF"
                                                           FontSize="18"
                                                           FontWeight="Bold"
                                                           HorizontalAlignment="Center" />

                                                <TextBlock Text="Click 'Send' to make your first request"
                                                           Foreground="#A0A0A0"
                                                           FontSize="14"
                                                           HorizontalAlignment="Center"
                                                           TextWrapping="Wrap"
                                                           TextAlignment="Center"
                                                           MaxWidth="300" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- Content with data -->
                                    <Grid IsVisible="{Binding RequestViewModel.HasResponseData}">
                                        <!-- Hamburger -->
                                        <Button HorizontalAlignment="Right"
                                                VerticalAlignment="Top"
                                                Margin="10"
                                                ZIndex="100"
                                                Classes="ActionButton">
                                            <lucide:Lucide Icon="Menu" Width="16" Height="16" />

                                            <Button.Flyout>
                                                <MenuFlyout Placement="BottomEdgeAlignedRight">
                                                    <MenuItem Header="Pretty"
                                                              Command="{Binding RequestViewModel.SetPrettyFormatCommand}">
                                                        <MenuItem.Icon>
                                                            <lucide:Lucide Icon="Code"
                                                                           StrokeBrush="{DynamicResource AccentBrush}"
                                                                           Width="14" Height="14"
                                                                           IsVisible="{Binding RequestViewModel.IsPrettyActive}" />
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                    <MenuItem Header="Raw"
                                                              Command="{Binding RequestViewModel.SetRawFormatCommand}">
                                                        <MenuItem.Icon>
                                                            <lucide:Lucide Icon="Text"
                                                                           StrokeBrush="{DynamicResource AccentBrush}"
                                                                           Width="14" Height="14"
                                                                           IsVisible="{Binding RequestViewModel.IsRawActive}" />
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                </MenuFlyout>
                                            </Button.Flyout>
                                        </Button>

                                        <!-- Copy Button -->
                                        <Button Classes="ActionButton"
                                                Command="{Binding CopyResponseCommand}"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Bottom"
                                                Margin="10"
                                                ZIndex="100"
                                                ToolTip.Tip="Copy to clipboard">
                                            <lucide:Lucide Icon="Copy" Width="16" Height="16" />
                                        </Button>

                                        <controls:JsonEditor
                                            Text="{Binding RequestViewModel.ResponseContent, Mode=OneWay}"
                                            MinWidth="100"
                                            MinHeight="100"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Stretch" />
                                    </Grid>
                                </Grid>
                            </Border>

                            <!-- HEADERS TAB -->
                            <Border Background="{DynamicResource BgElevated}"
                                    BorderBrush="{DynamicResource BorderColor}"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Margin="20"
                                    IsVisible="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Headers}">
                                <Grid>
                                    <!-- Empty State -->
                                    <Border Background="#1A1A1A"
                                            CornerRadius="12"
                                            IsVisible="{Binding !RequestViewModel.HasResponseData}">
                                        <StackPanel VerticalAlignment="Center"
                                                    HorizontalAlignment="Center"
                                                    Spacing="20"
                                                    Margin="40">

                                            <Border Background="#252526"
                                                    Width="80"
                                                    Height="80"
                                                    CornerRadius="40"
                                                    HorizontalAlignment="Center">
                                                <lucide:Lucide Icon="ListTree"
                                                               StrokeBrush="#10B981"
                                                               Width="40"
                                                               Height="40"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center" />
                                            </Border>

                                            <StackPanel Spacing="8" HorizontalAlignment="Center">
                                                <TextBlock Text="No Headers"
                                                           Foreground="#FFFFFF"
                                                           FontSize="18"
                                                           FontWeight="Bold"
                                                           HorizontalAlignment="Center" />

                                                <TextBlock
                                                    Text="Response headers will appear here after sending a request"
                                                    Foreground="#A0A0A0"
                                                    FontSize="14"
                                                    HorizontalAlignment="Center"
                                                    TextWrapping="Wrap"
                                                    TextAlignment="Center"
                                                    MaxWidth="300" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- Content with data -->
                                    <ScrollViewer IsVisible="{Binding RequestViewModel.HasResponseData}">
                                        <StackPanel Margin="20">
                                            <TextBlock Text="RESPONSE HEADERS"
                                                       Classes="SectionTitle"
                                                       Margin="0,0,0,12" />

                                            <ItemsControl ItemsSource="{Binding RequestViewModel.ResponseHeaders}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{DynamicResource BgMain}"
                                                                BorderBrush="{DynamicResource BorderColor}"
                                                                BorderThickness="0,0,0,1"
                                                                Padding="12,10">
                                                            <Grid ColumnDefinitions="200, *">
                                                                <TextBlock Grid.Column="0"
                                                                           Text="{Binding Name}"
                                                                           Foreground="{DynamicResource AccentBrush}"
                                                                           FontWeight="Medium"
                                                                           FontSize="12"
                                                                           TextTrimming="CharacterEllipsis"
                                                                           ToolTip.Tip="{Binding Name}" />
                                                                <TextBlock Grid.Column="1"
                                                                           Text="{Binding Value}"
                                                                           Foreground="{DynamicResource TextSecondary}"
                                                                           FontSize="12"
                                                                           TextWrapping="Wrap"
                                                                           TextTrimming="CharacterEllipsis"
                                                                           ToolTip.Tip="{Binding Value}" />
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </ScrollViewer>
                                </Grid>
                            </Border>

                            <!-- COOKIES TAB -->
                            <Border Background="{DynamicResource BgElevated}"
                                    BorderBrush="{DynamicResource BorderColor}"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Margin="20"
                                    IsVisible="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Cookies}">
                                <Grid>
                                    <!-- Empty State -->
                                    <Border Background="#1A1A1A"
                                            CornerRadius="12"
                                            IsVisible="{Binding !RequestViewModel.HasResponseData}">
                                        <StackPanel VerticalAlignment="Center"
                                                    HorizontalAlignment="Center"
                                                    Spacing="20"
                                                    Margin="40">

                                            <Border Background="#252526"
                                                    Width="80"
                                                    Height="80"
                                                    CornerRadius="40"
                                                    HorizontalAlignment="Center">
                                                <lucide:Lucide Icon="Cookie"
                                                               StrokeBrush="#F59E0B"
                                                               Width="40"
                                                               Height="40"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center" />
                                            </Border>

                                            <StackPanel Spacing="8" HorizontalAlignment="Center">
                                                <TextBlock Text="No Cookies"
                                                           Foreground="#FFFFFF"
                                                           FontSize="18"
                                                           FontWeight="Bold"
                                                           HorizontalAlignment="Center" />

                                                <TextBlock Text="Response cookies will be displayed here"
                                                           Foreground="#A0A0A0"
                                                           FontSize="14"
                                                           HorizontalAlignment="Center"
                                                           TextWrapping="Wrap"
                                                           TextAlignment="Center"
                                                           MaxWidth="300" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- Content with data -->
                                    <ScrollViewer IsVisible="{Binding RequestViewModel.HasResponseData}">
                                        <StackPanel Margin="20">
                                            <TextBlock Text="RESPONSE COOKIES"
                                                       Classes="SectionTitle"
                                                       Margin="0,0,0,12" />

                                            <ItemsControl ItemsSource="{Binding RequestViewModel.ResponseCookies}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{DynamicResource BgMain}"
                                                                BorderBrush="{DynamicResource BorderColor}"
                                                                BorderThickness="0,0,0,1"
                                                                Padding="12,10">
                                                            <Grid ColumnDefinitions="200, *">
                                                                <TextBlock Grid.Column="0"
                                                                           Text="{Binding Name}"
                                                                           Foreground="{DynamicResource AccentBrush}"
                                                                           FontWeight="Medium"
                                                                           FontSize="12"
                                                                           TextTrimming="CharacterEllipsis"
                                                                           ToolTip.Tip="{Binding Name}" />
                                                                <TextBlock Grid.Column="1"
                                                                           Text="{Binding Value}"
                                                                           Foreground="{DynamicResource TextSecondary}"
                                                                           FontSize="12"
                                                                           TextTrimming="CharacterEllipsis"
                                                                           ToolTip.Tip="{Binding Value}" />
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </ScrollViewer>
                                </Grid>
                            </Border>

                            <!-- TIMELINE TAB -->
                            <Border Background="{DynamicResource BgElevated}"
                                    BorderBrush="{DynamicResource BorderColor}"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Margin="20"
                                    IsVisible="{Binding SelectedResponseTab, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Timeline}">
                                <Grid>
                                    <!-- Empty State -->
                                    <Border Background="#1A1A1A"
                                            CornerRadius="12"
                                            IsVisible="{Binding !RequestViewModel.HasResponseData}">
                                        <StackPanel VerticalAlignment="Center"
                                                    HorizontalAlignment="Center"
                                                    Spacing="20"
                                                    Margin="40">

                                            <Border Background="#252526"
                                                    Width="80"
                                                    Height="80"
                                                    CornerRadius="40"
                                                    HorizontalAlignment="Center">
                                                <lucide:Lucide Icon="Timer"
                                                               StrokeBrush="#06B6D4"
                                                               Width="40"
                                                               Height="40"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center" />
                                            </Border>

                                            <StackPanel Spacing="8" HorizontalAlignment="Center">
                                                <TextBlock Text="No Timeline Data"
                                                           Foreground="#FFFFFF"
                                                           FontSize="18"
                                                           FontWeight="Bold"
                                                           HorizontalAlignment="Center" />

                                                <TextBlock Text="Send a request to see detailed timing breakdown"
                                                           Foreground="#A0A0A0"
                                                           FontSize="14"
                                                           HorizontalAlignment="Center"
                                                           TextWrapping="Wrap"
                                                           TextAlignment="Center"
                                                           MaxWidth="300" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- Timeline Data -->
                                    <ScrollViewer IsVisible="{Binding RequestViewModel.HasResponseData}">
                                        <StackPanel Margin="20" Spacing="20">

                                            <!-- Header -->
                                            <Grid ColumnDefinitions="*, Auto">
                                                <StackPanel Grid.Column="0">
                                                    <TextBlock Text="Timeline"
                                                               Foreground="{DynamicResource TextPrimary}"
                                                               FontSize="16"
                                                               FontWeight="SemiBold" />
                                                    <TextBlock Margin="0,4,0,0">
                                                        <Run Text="Total "
                                                             Foreground="{DynamicResource TextSecondary}"
                                                             FontSize="12" />
                                                        <Run Text="{Binding RequestViewModel.ResponseTime}"
                                                             Foreground="{DynamicResource AccentTeal}"
                                                             FontWeight="SemiBold"
                                                             FontSize="12" />
                                                    </TextBlock>
                                                </StackPanel>
                                            </Grid>

                                            <!-- Waterfall Chart -->
                                            <Border Background="{DynamicResource BgMain}"
                                                    BorderBrush="{DynamicResource BorderColor}"
                                                    BorderThickness="1"
                                                    CornerRadius="8"
                                                    Padding="16">
                                                <ItemsControl ItemsSource="{Binding RequestViewModel.TimelineStages}">
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Grid Margin="0,6" ColumnDefinitions="140, *, 80"
                                                                  ColumnSpacing="12">

                                                                <!-- Stage Name with Color Dot -->
                                                                <Grid Grid.Column="0"
                                                                      ColumnDefinitions="Auto, *"
                                                                      ColumnSpacing="8"
                                                                      VerticalAlignment="Center">
                                                                    <Border Grid.Column="0"
                                                                            Width="10"
                                                                            Height="10"
                                                                            Background="{Binding Color}"
                                                                            CornerRadius="5" />
                                                                    <TextBlock Grid.Column="1"
                                                                               Text="{Binding Name}"
                                                                               Foreground="{DynamicResource TextSecondary}"
                                                                               FontSize="12"
                                                                               TextTrimming="CharacterEllipsis"
                                                                               VerticalAlignment="Center" />
                                                                </Grid>

                                                                <!-- Progress Bar Container -->
                                                                <Border Grid.Column="1"
                                                                        Height="20"
                                                                        Background="{DynamicResource BgDark}"
                                                                        CornerRadius="4"
                                                                        VerticalAlignment="Center">
                                                                    <Grid>
                                                                        <!-- The Bar -->
                                                                        <Border HorizontalAlignment="Left"
                                                                                Background="{Binding Color}"
                                                                                CornerRadius="4"
                                                                                Height="20">
                                                                            <Border.Width>
                                                                                <MultiBinding
                                                                                    Converter="{StaticResource PercentToPixelConverter}">
                                                                                    <Binding Path="WidthPercent" />
                                                                                    <Binding
                                                                                        RelativeSource="{RelativeSource AncestorType=Border}"
                                                                                        Path="Bounds.Width" />
                                                                                </MultiBinding>
                                                                            </Border.Width>
                                                                        </Border>
                                                                    </Grid>
                                                                </Border>

                                                                <!-- Duration -->
                                                                <TextBlock Grid.Column="2"
                                                                           Text="{Binding DurationText}"
                                                                           Foreground="{DynamicResource TextPrimary}"
                                                                           FontWeight="Medium"
                                                                           FontSize="12"
                                                                           VerticalAlignment="Center"
                                                                           TextAlignment="Right" />
                                                            </Grid>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </Border>
                                        </StackPanel>
                                    </ScrollViewer>
                                </Grid>
                            </Border>
                        </Grid>

                    </Grid>
                </Grid>
            </Grid>
        </Grid>
    </Panel>
</Window>