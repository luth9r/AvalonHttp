<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AvalonHttp.ViewModels"
        xmlns:lucide="clr-namespace:LucideAvalonia;assembly=LucideAvalonia"
        xmlns:behaviors="clr-namespace:AvalonHttp.Behaviors"
        xmlns:shared="clr-namespace:AvalonHttp.Views.Shared"
        xmlns:collections="clr-namespace:AvalonHttp.Views"
        xmlns:environments="clr-namespace:AvalonHttp.Views"
        
        x:Class="AvalonHttp.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        
        Title="AvalonHttp"
        Width="1200" Height="750"
        MinWidth="900" MinHeight="550"
        Background="{DynamicResource BgDark}"
        TransparencyLevelHint="AcrylicBlur"
        ExtendClientAreaToDecorationsHint="True"
        Focusable="True"
        ExtendClientAreaChromeHints="PreferSystemChrome"
        WindowStartupLocation="CenterScreen">

    <Interaction.Behaviors>
        <behaviors:ClearFocusOnClickBehavior />
    </Interaction.Behaviors>

    <Window.KeyBindings>
        <KeyBinding Gesture="Ctrl+S" Command="{Binding CollectionsWorkspace.RequestViewModel.SaveCurrentRequestCommand}" />
    </Window.KeyBindings>

    <Panel>
        <Grid IsVisible="{Binding IsDialogOpen}" ZIndex="1000">
            <Border Background="Black" Opacity="0.5">
                <Interaction.Behaviors>
                    <EventTriggerBehavior EventName="PointerPressed">
                        <InvokeCommandAction Command="{Binding CancelConfirmCommand}" />
                    </EventTriggerBehavior>
                </Interaction.Behaviors>
            </Border>

            <Border Width="400" MinHeight="150"
                    Background="{DynamicResource BgElevated}"
                    BorderBrush="{DynamicResource BorderColor}"
                    BorderThickness="1"
                    CornerRadius="8"
                    BoxShadow="0 4 20 0 #40000000"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Padding="24">
                
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <lucide:Lucide Icon="OctagonAlert" StrokeBrush="#EF4444" Width="24" Height="24" />
                        <TextBlock Text="{Binding DialogTitle}" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center" />
                    </StackPanel>

                    <TextBlock Text="{Binding DialogMessage}" Foreground="{DynamicResource TextSecondary}" TextWrapping="Wrap" LineHeight="20" />

                    <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right" Margin="0,8,0,0">
                        <Button Content="Cancel" Command="{Binding CancelConfirmCommand}" Classes="SecondaryButton"/>
                        <Button Content="{Binding ConfirmButtonText}" Command="{Binding ExecuteConfirmCommand}" Background="#EF4444" Foreground="White"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <Grid RowDefinitions="40, *">

            <Border Grid.Row="0" 
                    Background="{DynamicResource BgElevated}" 
                    BorderThickness="0,0,0,1" 
                    BorderBrush="{DynamicResource BorderColor}"
                    PointerPressed="TopLevel_PointerPressed"> <Grid ColumnDefinitions="Auto, *, Auto">
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12" Margin="16,0" VerticalAlignment="Center">
                        <lucide:Lucide Icon="Zap" StrokeBrush="{DynamicResource AccentBrush}" Width="16" Height="16" />
                        <TextBlock Text="AvalonHttp" FontWeight="SemiBold" FontSize="13" VerticalAlignment="Center" />
                    </StackPanel>
                </Grid>
            </Border>

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="60" MinWidth="60" MaxWidth="60" /> <ColumnDefinition Width="*" /> </Grid.ColumnDefinitions>

                <shared:SideBarView Grid.Column="0" />

                <Grid Grid.Column="1">
                    
                    <collections:CollectionsWorkspaceView
                        DataContext="{Binding CollectionsWorkspace}"
                        IsVisible="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).IsCollectionsView}" />

                    <environments:EnvironmentsView
                        DataContext="{Binding EnvironmentsViewModel}"
                        IsVisible="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).IsEnvironmentsView}" />
                        
                </Grid>
            </Grid>

        </Grid>
    </Panel>
</Window>